<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>StreetWearX — Tienda Urbana</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="icon.png" />

<style>
/* --------------------- */
/* ESTILO STREETWEAR     */
/* --------------------- */
:root{
  --black:#000;
  --gold:#D4AF37;
  --gray:#f5f5f5;
  --card:#111;
  --text:#fff;
  --muted:#9ca3af;
  --danger:#ef4444;
  --success:#16a34a;
  --radius:12px;
}

body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#000;
  color:var(--text);
}

/* NAV */
nav{
  background:#000;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 20px;
  border-bottom:1px solid #222;
  position:sticky;
  top:0;
  z-index:10;
}

.logo{
  font-size:22px;
  font-weight:900;
  color:var(--gold);
  letter-spacing:1px;
}

.btn{
  background:#111;
  color:#fff;
  padding:8px 12px;
  border-radius:var(--radius);
  border:1px solid #333;
  cursor:pointer;
  font-size:13px;
}

.btn-gold{
  background:var(--gold);
  color:#000;
  font-weight:600;
}

.btn-danger{
  background:var(--danger);
}

.btn-outline{
  background:transparent;
  border:1px solid var(--gold);
  color:var(--gold);
}

/* Contenedor principal */
main{
  padding:20px;
}

/* Productos */
.products{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:15px;
}

.card{
  background:#111;
  padding:12px;
  border-radius:var(--radius);
  border:1px solid #222;
}

.card img{
  width:100%;
  height:200px;
  object-fit:cover;
  border-radius:var(--radius);
}

.card-title{
  margin-top:8px;
  font-size:15px;
  font-weight:600;
}

.card-price{
  color:var(--gold);
  font-weight:700;
  margin:4px 0;
}

.card-footer{
  display:flex;
  justify-content:space-between;
  margin-top:8px;
}

/* Carrito */
#cartPanel{
  position:fixed;
  right:-100%;
  top:0;
  width:85%;
  max-width:380px;
  height:100%;
  background:#111;
  color:#fff;
  transition:.3s;
  padding:20px;
  overflow-y:auto;
  border-left:2px solid var(--gold);
  z-index:20;
}

#cartPanel.active{
  right:0;
}

.cart-item{
  display:flex;
  gap:10px;
  border-bottom:1px solid #222;
  padding:10px 0;
}

.cart-item img{
  width:60px;
  height:60px;
  border-radius:var(--radius);
}

/* Modal: admin */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:30;
}

#modal.active{display:flex;}

.modal-box{
  background:#111;
  padding:20px;
  width:90%;
  max-width:400px;
  border-radius:var(--radius);
  border:1px solid var(--gold);
}

/* Instalación PWA */
#installBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  padding:12px 18px;
  background:var(--gold);
  color:#000;
  font-weight:700;
  border-radius:var(--radius);
  display:none;
  z-index:50;
}
</style>
</head>

<body>

<nav>
  <div class="logo">StreetWearX</div>

  <div style="display:flex;gap:10px;">
    <button class="btn-outline" id="adminBtn">Admin</button>
    <button class="btn-gold" id="cartBtn">Carrito (<span id="cartCount">0</span>)</button>
  </div>
</nav>

<main>
  <h2 style="color:var(--gold);margin-bottom:10px;">Productos</h2>
  <div id="products" class="products"></div>
</main>


<!-- PANEL CARRITO -->
<div id="cartPanel">
  <h2 style="color:var(--gold);">Carrito</h2>
  <div id="cartItems"></div>
  <h3>Total: <span id="cartTotal">$0.00</span></h3>
  <button class="btn-gold" style="width:100%;">Finalizar compra</button>
</div>


<!-- MODAL ADMIN -->
<div id="modal">
  <div class="modal-box">
    <h3 style="color:var(--gold);" id="modalTitle">Nuevo producto</h3>

    <input id="pName" placeholder="Nombre" style="width:100%;margin-bottom:6px;">
    <input id="pPrice" type="number" placeholder="Precio" style="width:100%;margin-bottom:6px;">
    <input id="pCategory" placeholder="Categoría" style="width:100%;margin-bottom:6px;">
    <input id="pImage" type="file" style="width:100%;margin-bottom:6px;">
    <textarea id="pDescription" placeholder="Descripción" style="width:100%;height:80px;margin-bottom:6px;"></textarea>

    <button class="btn-gold" id="saveProduct" style="width:100%;">Guardar</button>
  </div>
</div>

<button id="installBtn">Instalar App</button>


<!-- SISTEMA APP -->
<script type="module">

/* ----------------------------------------- */
/* FIREBASE CONFIG (YA COLOCADO TUYO)        */
/* ----------------------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-Ag7WIUBcGgJPBg6taUqtGVHgWAwekhY",
  authDomain: "proyect1-37d04.firebaseapp.com",
  projectId: "proyect1-37d04",
  storageBucket: "proyect1-37d04.firebasestorage.app",
  messagingSenderId: "989990045683",
  appId: "1:989990045683:web:778984a898aa4046097486",
  measurementId: "G-WBQ6DYGRG8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ----------------------------------------- */
/* CLOUDINARY CONFIG (YA COLOCADO TUYO)      */
/* ----------------------------------------- */
const CLOUD_NAME = "dv5pdjhso";
const PRESET = "streetwearx_unsigned";

async function uploadImage(file){
  const form = new FormData();
  form.append("file", file);
  form.append("upload_preset", PRESET);

  const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
    method:"POST",
    body: form
  });
  const data = await res.json();
  return data.secure_url;
}

/* ----------------------------------------- */
/* ESTADO GLOBAL                             */
/* ----------------------------------------- */
let allProducts = [];
let cart = JSON.parse(localStorage.getItem("swx_cart") || "[]");
let editingId = null;

/* ----------------------------------------- */
/* MOSTRAR PRODUCTOS                         */
/* ----------------------------------------- */
async function loadProducts(){
  const snapshot = await getDocs(collection(db,"products"));
  allProducts = [];
  snapshot.forEach(docu => allProducts.push({id:docu.id,...docu.data()}));
  renderProducts();
}

function renderProducts(){
  products.innerHTML = allProducts.map(p=>`
    <div class="card">
      <img src="${p.imageURL}">
      <div class="card-title">${p.name}</div>
      <div class="card-price">$${p.price}</div>

      <div class="card-footer">
        <button class="btn" onclick="addToCart('${p.id}')">Agregar</button>
        <button class="btn-outline" onclick="editProduct('${p.id}')">Editar</button>
      </div>
    </div>
  `).join("");
}

/* ----------------------------------------- */
/* CARRITO                                   */
/* ----------------------------------------- */
function saveCart(){
  localStorage.setItem("swx_cart", JSON.stringify(cart));
}

window.addToCart = function(id){
  const product = allProducts.find(p=>p.id===id);
  const existing = cart.find(i=>i.id===id);

  if(existing) existing.qty++;
  else cart.push({...product, qty:1});

  saveCart();
  updateCartUI();
};

function updateCartUI(){
  cartItems.innerHTML = cart.map(i=>`
    <div class="cart-item">
      <img src="${i.imageURL}">
      <div>
        <div>${i.name}</div>
        <div>$${i.price}</div>
        <div>Cantidad: ${i.qty}</div>
      </div>
    </div>
  `).join("");

  const total = cart.reduce((s,i)=>s+(i.qty*i.price),0);
  cartTotal.textContent = "$" + total.toFixed(2);
  cartCount.textContent = cart.reduce((s,i)=>s+i.qty,0);
}

/* ----------------------------------------- */
/* ADMIN PANEL                               */
/* ----------------------------------------- */
window.editProduct = function(id){
  editingId = id;
  const p = allProducts.find(x=>x.id===id);

  pName.value = p.name;
  pPrice.value = p.price;
  pCategory.value = p.category;
  pDescription.value = p.description;

  modalTitle.textContent = "Editar producto";
  modal.classList.add("active");
};

saveProduct.onclick = async () => {
  const name = pName.value;
  const price = +pPrice.value;
  const category = pCategory.value;
  const description = pDescription.value;
  let imageURL = null;

  if(pImage.files.length){
    imageURL = await uploadImage(pImage.files[0]);
  }

  const payload = {name,price,category,description};
  if(imageURL) payload.imageURL = imageURL;

  if(editingId){
    await updateDoc(doc(db,"products",editingId),payload);
  } else{
    await addDoc(collection(db,"products"),payload);
  }

  modal.classList.remove("active");
  editingId = null;
  loadProducts();
};

/* ----------------------------------------- */
/* INSTALAR PWA                              */
/* ----------------------------------------- */
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", e=>{
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = "block";
});

installBtn.addEventListener("click", async ()=>{
  installBtn.style.display = "none";
  deferredPrompt.prompt();
});

/* ----------------------------------------- */
/* EVENTOS UI                                */
/* ----------------------------------------- */
adminBtn.onclick = ()=> modal.classList.add("active");
cartBtn.onclick = ()=> cartPanel.classList.add("active");
document.body.onclick = e=>{
  if(e.target===cartPanel) cartPanel.classList.remove("active");
};

/* ----------------------------------------- */
/* INICIO                                    */
/* ----------------------------------------- */
loadProducts();
updateCartUI();

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js");
}

</script>

</body>
</html>
