<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="StreetWearX - Tienda de Ropa Urbana">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="StreetWearX">
    
    <title>StreetWearX - Tienda de Ropa Urbana</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Monofett&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #f3eff0;
            --secondary: #000000;
            --accent: #0d0d0e;
            --light: #f5f5f5;
            --text: #0e0808;
            --border: #ddd;
            --white: #e60f0f;
            --gray: #2855eb;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff;
            color: var(--text);
            overflow-x: hidden;
            letter-spacing: 0.3px;
            line-height: 1.6;
        }

        /* Header */
        header {
            background: var(--white);
            color: var(--secondary);
            padding: 1.2rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: none;
            border-bottom: 1px solid var(--border);
        }

        /* Background video (full-page, behind everything) */
        #bgVideo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            pointer-events: none;
            opacity: 0.85;
            filter: brightness(0.85) saturate(1.05);
        }

        /* Optional overlay if you want a darker tint; leave hidden by default */
        .bg-video-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.18);
            z-index: 0;
            pointer-events: none;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: 900;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
            text-transform: uppercase;
        }

        .header-icons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--secondary);
            font-size: 1.3rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            transform: scale(1.15);
            color: var(--primary);
            filter: drop-shadow(0 0 8px rgba(220, 20, 60, 0.3));
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.4);
        }

        /* Modal Autenticaci√≥n */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .auth-modal.active {
            display: flex;
        }

        /* Mostrar solo la pesta√±a activa en el modal de autenticaci√≥n */
        .auth-tab-content {
            display: none;
        }

        .auth-tab-content.active {
            display: block;
        }

        /* Entry Modal (mode selection) */
        .entry-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.75);
            z-index: 210;
            align-items: center;
            justify-content: center;
        }

        .entry-modal.active {
            display: flex;
        }

        .entry-content {
            background: white;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .entry-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }

        .entry-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            border: none;
            background: var(--primary);
            color: white;
        }

        .entry-btn.secondary {
            background: var(--accent);
        }

        .auth-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .auth-content h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
            font-size: 1.5rem;
            letter-spacing: 1px;
        }

        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background: var(--light);
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid var(--border);
            border-radius: 0;
            font-size: 0.95rem;
            font-family: 'Poppins', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: none;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .hero .btn-primary {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            box-shadow: none;
            animation: fadeInUp 1s ease 0.3s both;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
            border: 2px solid transparent;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #333;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: var(--secondary);
        }

        /* Sidebar Menu */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: var(--secondary);
            color: white;
            transition: left 0.3s ease;
            z-index: 150;
            overflow-y: auto;
            padding-top: 80px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
        }

        .sidebar.active {
            left: 0;
            box-shadow: 2px 0 15px rgba(0,0,0,0.25);
        }

        .sidebar-item {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar-item:hover {
            background: rgba(220, 20, 60, 0.1);
            padding-left: 1.5rem;
            box-shadow: none;
        }

        .sidebar-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.95rem;
        }

        .sidebar-submenu {
            display: none;
            padding-left: 2rem;
        }

        .sidebar-submenu.active {
            display: block;
        }

        .submenu-item {
            padding: 0.75rem 0;
            font-size: 0.9rem;
            color: #ccc;
            transition: all 0.3s ease;
        }

        .submenu-item:hover {
            color: var(--white);
            padding-left: 0.5rem;
            text-shadow: none;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 140;
        }

        .overlay.active {
            display: block;
        }

        /* Main Content */
        main {
            padding: 0;
            max-width: 100%;
            margin: 0 auto;
        }

        /* Video Banner */
        .video-banner {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-banner video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .video-banner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(220, 20, 60, 0.15));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            z-index: 10;
        }

        .video-banner-content h1 {
            font-size: 4.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            animation: fadeInDown 1s ease both;
        }

        .video-banner-content p {
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 2rem;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
            animation: fadeInUp 1s ease 0.2s both;
        }

        .video-banner-content .btn-primary {
            width: auto;
            padding: 1rem 3rem;
            font-size: 1rem;
            animation: fadeInUp 1s ease 0.4s both;
        }

        .hero {
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1552062407-291826a7b2d5?w=1400&h=500&fit=crop') center/cover;
            color: white;
            padding: 8rem 2rem;
            border-radius: 0;
            margin-bottom: 4rem;
            margin-top: 0;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: none;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: none;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
            text-shadow: none;
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            text-shadow: none;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Filter Section */
        .filter-section {
            margin-bottom: 3rem;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
            background: white;
            padding: 2rem;
            border-radius: 0;
            box-shadow: none;
            border-bottom: 1px solid var(--border);
            max-width: 100%;
        }

        .filter-section select {
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0;
            font-size: 0.95rem;
            background: white;
            font-weight: 400;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .filter-section select:hover {
            border-color: var(--primary);
            box-shadow: none;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.6rem;
            margin-bottom: 3rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 1rem;
        }

        .product-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: none;
            position: relative;
        }

        .product-card:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .product-image {
            width: 100%;
            height: auto;
            aspect-ratio: 4 / 3;
            object-fit: cover;
            background-color: var(--light);
            transition: all 0.28s ease;
            border-radius: 6px;
            display:block;
            max-height:420px;
        }

        .product-card:hover .product-image {
            transform: none;
            filter: brightness(0.95);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-category {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .product-price {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .product-rating {
            color: #ffc107;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .btn-add-cart {
            width: 100%;
            background: var(--primary);
            color: white;
            border: 2px solid transparent;
            padding: 0.9rem;
            border-radius: 0;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .btn-add-cart:hover {
            background: var(--secondary);
            box-shadow: none;
            transform: none;
        }

        /* Shopping Cart */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 420px;
            height: 100%;
            background-color: white;
            box-shadow: -6px 0 30px rgba(0,0,0,0.12);
            z-index: 180;
            transition: right 0.28s cubic-bezier(.2,.9,.2,1);
            overflow-y: auto;
            flex-direction: column;
            border-radius: 0;
        }

        .cart-modal.active {
            display: flex;
            right: 0;
            box-shadow: -8px 0 40px rgba(0,0,0,0.16);
        }

        .cart-header {
            background: white;
            color: var(--primary);
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: none;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .cart-close-btn {
            position: absolute;
            top: 14px;
            left: 14px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 190;
            box-shadow: 0 6px 18px rgba(0,0,0,0.18);
        }

        .cart-items {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .cart-item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: bold;
        }

        .cart-item-qty {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-items: center;
        }

        .qty-btn {
            background-color: var(--light);
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }

        .qty-btn:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .cart-remove {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .cart-footer {
            background-color: var(--light);
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .btn-checkout {
            width: 100%;
            background: var(--primary);
            color: white;
            padding: 1.1rem;
            border: none;
            border-radius: 0;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .btn-checkout:hover {
            background: var(--secondary);
            transform: none;
            box-shadow: none;
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: #999;
        }

        /* Loading & Messages */
        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid transparent;
            border-right: 4px solid var(--accent);
            border-bottom: 4px solid transparent;
            border-left: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            padding: 1.2rem 1.8rem;
            border-radius: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);            animation: slideUp 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            z-index: 300;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.75);
            z-index: 250;
            align-items: center;
            justify-content: center;
        }

        .admin-panel.active {
            display: flex;
        }

        /* Role-based visibility */
        .admin-only {
            display: none;
        }

        .admin-only.visible {
            display: block;
        }

        .client-only {
            display: block;
        }

        .client-only.hidden {
            display: none;
        }

        .admin-content {
            background: white;
            padding: 2.5rem;
            border-radius: 0;
            width: 90%;
            max-width: 850px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .admin-tabs {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            border-bottom: 3px solid var(--primary);
        }

        .admin-tab-btn {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .admin-tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            header {
                padding: 1rem 0.8rem;
            }

            .logo {
                font-size: 1.3rem;
                letter-spacing: 1.5px;
            }

            .icon-btn {
                font-size: 1.1rem;
            }

            .video-banner {
                height: 60vh;
                min-height: 400px;
            }

            .video-banner-content h1 {
                font-size: 2.5rem;
                letter-spacing: 1px;
            }

            .video-banner-content p {
                font-size: 1rem;
                letter-spacing: 0.5px;
            }

            .video-banner-content .btn-primary {
                padding: 0.8rem 2rem;
                font-size: 0.9rem;
            }

            .hero {
                padding: 3rem 1.5rem;
                min-height: 280px;
                border-radius: 0;
                margin-top: 0;
            }

            .hero h1 {
                font-size: 2.2rem;
                line-height: 1.3;
                margin-bottom: 1rem;
            }

            .hero p {
                font-size: 1rem;
                margin-bottom: 1.5rem;
            }

            .hero button {
                padding: 0.75rem 2rem;
                font-size: 0.95rem;
            }

            .search-bar {
                width: 100%;
                margin-bottom: 1.5rem;
            }

            .search-bar input {
                width: 100%;
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }

            .filters {
                flex-direction: column;
                gap: 1rem;
                padding: 1.5rem 1rem;
            }

            .filters select, .filters button {
                width: 100%;
                padding: 0.75rem 1rem;
                font-size: 0.95rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
                padding: 1rem 0.8rem;
            }

            .product-card {
                box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            }

            .product-card:hover {
                transform: translateY(-6px);
                box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            }

            .product-image {
                aspect-ratio: 4 / 3;
                height: auto;
                max-height: 340px;
            }

            /* Cart modal full-screen on small devices */
            .cart-modal {
                right: 0 !important;
                width: 100%;
                max-width: 100%;
            }

            .cart-close-btn { top: 10px; left: 10px }

            .product-info {
                padding: 1rem;
            }

            .product-category {
                font-size: 0.75rem;
                letter-spacing: 0.5px;
            }

            .product-name {
                font-size: 0.95rem;
                margin-bottom: 0.5rem;
            }

            .product-price {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
            }

            .product-btn {
                padding: 0.65rem 1rem;
                font-size: 0.9rem;
                letter-spacing: 0.5px;
            }

            .cart-modal {
                width: 100%;
                max-width: 100%;
                right: -100%;
                height: 100%;
                border-radius: 0;
            }

            .cart-header {
                padding: 1.5rem 1rem;
            }

            .cart-items {
                max-height: calc(100vh - 200px);
                padding: 0 1rem;
            }

            .cart-item {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .cart-footer {
                padding: 1.5rem 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-group input, .form-group select {
                width: 100%;
                padding: 0.85rem 1rem;
                font-size: 1rem;
            }

            .auth-content {
                width: 95%;
                padding: 2rem 1.5rem;
            }

            .auth-content h2 {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
                letter-spacing: 1px;
            }

            .admin-content {
                width: 95%;
                max-height: 90vh;
                padding: 2rem 1.5rem;
            }

            .admin-content h3 {
                font-size: 1.5rem;
                letter-spacing: 1px;
                margin-bottom: 1.5rem;
            }

            .admin-tabs {
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 1.5rem;
            }

            .admin-tab {
                padding: 0.75rem 1rem;
                font-size: 0.95rem;
                letter-spacing: 0.5px;
            }

            .sidebar {
                width: 100%;
                border-radius: 0;
            }

            .sidebar-title {
                font-size: 1.1rem;
                letter-spacing: 1px;
                padding: 1rem 1.5rem;
            }

            .submenu-item {
                padding: 0.75rem 3rem;
                font-size: 0.95rem;
            }

            .sidebar-item:active .sidebar-title {
                background-color: rgba(220, 20, 60, 0.1);
            }

            .toast {
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                max-width: 90vw;
                width: auto;
                font-size: 0.95rem;
                padding: 1rem 1.5rem;
            }
        }
        /* Admin extra styles (polish) */
        .image-previews { display:flex; gap:12px; flex-wrap:wrap; margin-top:8px }
        .preview-wrap { position:relative; width:96px; height:96px; border-radius:10px; overflow:hidden }
        .thumb-img { width:100%; height:100%; object-fit:cover; display:block; border-radius:10px; border:1px solid rgba(240,242,245,0.9); box-shadow:0 8px 30px rgba(10,20,30,0.06) }
        .thumb-overlay { position:absolute; inset:0; display:flex; align-items:flex-end; justify-content:space-between; padding:8px; box-sizing:border-box; pointer-events:none }
        .thumb-btn { background:rgba(0,0,0,0.65); color:#fff; border:none; padding:6px 8px; font-size:12px; border-radius:8px; cursor:pointer; pointer-events:auto }
        .primary-badge { position:absolute; top:-10px; left:-10px; background:linear-gradient(90deg,#ff9a00,#ff3d00); color:white; font-size:12px; padding:6px 10px; border-radius:999px; box-shadow:0 8px 30px rgba(0,0,0,0.12) }
        .muted { color:#666; font-size:13px }
        .admin-content .admin-form { background:linear-gradient(180deg,#fff,#fbfbfb); border-radius:12px; padding:16px; border:1px solid #f0f2f5 }
        #productImagePreviews .preview-wrap:hover .thumb-btn { opacity:1 }

        /* Admin modal polish */
        .admin-panel { backdrop-filter: blur(4px); }
        .admin-content { border-radius:12px; max-width:980px; padding:28px; box-shadow: 0 20px 60px rgba(10,20,30,0.18); border:1px solid rgba(0,0,0,0.06) }
        .admin-content h2 { font-weight:800; letter-spacing:0.6px; color:var(--secondary); margin-bottom:8px }
        .admin-tabs { gap:2rem; border-bottom:4px solid rgba(0,0,0,0.03); margin-bottom:1.25rem }
        .admin-tab-btn { padding:10px 14px; border-radius:8px 8px 0 0; background:transparent; border:none; font-weight:700 }
        .admin-tab-btn.active { background:linear-gradient(90deg,var(--primary),var(--accent)); color:white; box-shadow:0 6px 18px rgba(220,20,60,0.12) }
        .form-row label { display:block; margin-bottom:6px; font-weight:700; color:#333; font-size:0.9rem }
        .form-row input, .form-row select, .form-row textarea { border:1px solid #e6e9ee; padding:0.65rem 0.9rem; border-radius:8px; background:white }
        input[type=file] { padding:6px 8px; border-radius:8px; border:1px dashed #e6e9ee; cursor:pointer }
        .btn { border-radius:8px }
        .btn-primary { box-shadow: 0 8px 30px rgba(220,20,60,0.12) }
        .close-modal { font-size:1.4rem; background:transparent; border-radius:8px; padding:6px }
        @media (max-width:768px) { .admin-content { padding:18px; width:95% } }
        /* Sidebar active states */
        .submenu-item.active { background: linear-gradient(90deg,var(--primary),var(--accent)); color: #fff; font-weight:700; border-radius:6px; padding-left:0.6rem }
        .sidebar-item.selected { background: rgba(220,20,60,0.06); }
        .sidebar-item.selected .sidebar-title { color: var(--primary); font-weight:800 }
        /* Compact promotional banner */
        .compact-banner {
            width: 100%;
            background: linear-gradient(90deg, rgba(220,20,60,0.95), rgba(255,122,64,0.95));
            color: #fff;
            padding: 14px 12px;
            border-radius: 10px;
            box-shadow: 0 12px 36px rgba(10,20,30,0.08);
            margin: 18px 0;
        }
        .compact-banner .banner-inner { max-width: 1200px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px }
        .compact-banner h2 { margin: 0; font-size: 1.25rem; font-weight:800 }
        .compact-banner p { margin: 0; opacity: 0.95 }
        .compact-banner .cta { background: #fff; color: var(--primary); border: none; padding: 8px 12px; border-radius: 8px; font-weight:800; cursor:pointer }
        @media (max-width: 768px) {
            .compact-banner { padding: 12px; }
            .compact-banner .banner-inner { flex-direction: column; text-align:center }
            .compact-banner h2 { font-size: 1.05rem }
        }
        /* Product Carousel */
        .carousel-container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; position: relative }
        .carousel-header { display:flex; align-items:center; justify-content:space-between; margin: 24px 0 16px 0 }
        .carousel-header h3 { font-size: 1.4rem; font-weight:800; margin:0 }
        .carousel-controls { display:flex; gap:8px }
        .carousel-btn { background: var(--primary); color:#fff; border:none; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; font-weight:800; box-shadow:0 6px 18px rgba(220,20,60,0.12) }
        .carousel-btn:hover { background: var(--secondary) }
        .carousel-wrapper { overflow: hidden; border-radius:10px; position:relative }
        .carousel-slides { display:flex; transition:transform 0.4s cubic-bezier(.2,.9,.2,1); gap:12px }
        .carousel-slide { min-width: 260px; flex-shrink: 0 }
        .carousel-slide .carousel-product-card { background:#fff; border:1px solid #e6e9ee; border-radius:8px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.06); cursor:pointer; transition:all 0.3s }
        .carousel-slide .carousel-product-card:hover { box-shadow:0 8px 24px rgba(0,0,0,0.12); transform:translateY(-4px) }
        .carousel-slide img { width:100%; height:200px; object-fit:cover }
        .carousel-slide .carousel-product-info { padding:12px }
        .carousel-slide .carousel-product-name { font-size:0.9rem; font-weight:700; margin-bottom:4px; color:var(--secondary) }
        .carousel-slide .carousel-product-price { color:var(--primary); font-weight:800; font-size:1.05rem }
        @media (max-width: 768px) {
            .carousel-slide { min-width: 200px }
            .carousel-header h3 { font-size: 1.15rem }
        }
/* Bot√≥n PWA estilo grafiti */
.pwa-install-container {
    margin: 0.7rem 1rem 0.2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    z-index: 10;
    position: relative;
}

.btn-install-pwa {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 999px;
    border: 2px dashed rgba(255, 255, 255, 0.7);
    background: linear-gradient(135deg, #000000, #ff1744);
    color: #ffffff;
    font-size: 0.9rem;
    font-weight: 600;
    letter-spacing: 1px;
    cursor: pointer;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 12px rgba(0,0,0,0.45);
    transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.3s ease;
    font-family: 'Monofett', cursive;
}

.btn-install-pwa:hover {
    transform: translateY(-1px) scale(1.02);
    box-shadow: 0 0 18px rgba(0,0,0,0.6);
    background: linear-gradient(135deg, #ff1744, #ff9100);
}

.btn-install-pwa:active {
    transform: scale(0.98);
}

.spray-icon {
    width: 14px;
    height: 14px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 30%, #ffffff 0, #ffeb3b 25%, #ff1744 60%, transparent 70%);
    position: relative;
    animation: sprayPulse 1.4s infinite ease-in-out;
}

.spray-icon::after {
    content: '';
    position: absolute;
    inset: -8px;
    border-radius: 999px;
    border: 1px dashed rgba(255,255,255,0.45);
    opacity: 0.65;
}

@keyframes sprayPulse {
    0%   { transform: scale(0.9); opacity: 0.7; }
    50%  { transform: scale(1.1); opacity: 1;   }
    100% { transform: scale(0.9); opacity: 0.7; }
}

.pwa-installed-label {
    font-size: 0.8rem;
    color: #00e676;
    text-shadow: 0 0 6px rgba(0,0,0,0.7);
}
        
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <a href="#" class="logo">StreetWearX</a>
        <div class="header-icons">
            <button class="icon-btn" id="searchBtn" title="Buscar">üîç</button>
            <button class="icon-btn" id="cartBtn" title="Carrito">
                üõí
                <span class="cart-count" id="cartCount">0</span>
            </button>
            <button class="icon-btn" id="modeBtn" title="Cambiar Modo">Modo: Cliente</button>
            <button class="icon-btn" id="userBtn" title="Usuario">üë§</button>
            <button class="icon-btn" id="menuBtn" title="Men√∫">‚ò∞</button>
        </div>
    </header>

    <!-- App Status (debug) -->
    <div id="appStatus" style="width:100%; background:#111; color:#fff; padding:0.4rem 1rem; font-size:0.9rem; text-align:left;">Estado: iniciando...</div>
<!-- Bot√≥n para instalar la PWA -->
<div class="pwa-install-container">
    <button id="pwaInstallBtn" class="btn-install-pwa" style="display:none;">
        <span class="spray-icon"></span>
        Instalar app
    </button>
    <span id="pwaInstalledLabel" class="pwa-installed-label" style="display:none;">
        App instalada ‚úî
    </span>
</div>
    <!-- Sidebar Menu -->
    <div class="overlay" id="overlay"></div>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-item" onclick="toggleSubmenu('hombres')">
            <div class="sidebar-title">üëï Hombres</div>
            <div class="sidebar-submenu" id="submenu-hombres">
                <div class="submenu-item" onclick="filterProducts('hombres', 'camisetas')">Camisetas</div>
                <div class="submenu-item" onclick="filterProducts('hombres', 'pantalones')">Pantalones</div>
                <div class="submenu-item" onclick="filterProducts('hombres', 'sudaderas')">Sudaderas</div>
                <div class="submenu-item" onclick="filterProducts('hombres', 'accesorios')">Accesorios</div>
            </div>
        </div>

        <div class="sidebar-item" onclick="toggleSubmenu('mujeres')">
            <div class="sidebar-title">üëó Mujeres</div>
            <div class="sidebar-submenu" id="submenu-mujeres">
                <div class="submenu-item" onclick="filterProducts('mujeres', 'camisetas')">Camisetas</div>
                <div class="submenu-item" onclick="filterProducts('mujeres', 'pantalones')">Pantalones</div>
                <div class="submenu-item" onclick="filterProducts('mujeres', 'faldas')">Faldas</div>
                <div class="submenu-item" onclick="filterProducts('mujeres', 'accesorios')">Accesorios</div>
            </div>
        </div>

        <div class="sidebar-item" onclick="toggleSubmenu('unisex')">
            <div class="sidebar-title">üß¢ Unisex</div>
            <div class="sidebar-submenu" id="submenu-unisex">
                <div class="submenu-item" onclick="filterProducts('unisex', 'gorras')">Gorras</div>
                <div class="submenu-item" onclick="filterProducts('unisex', 'mochilas')">Mochilas</div>
                <div class="submenu-item" onclick="filterProducts('unisex', 'zapatos')">Zapatos</div>
                <div class="submenu-item" onclick="filterProducts('unisex', 'accesorios')">Accesorios</div>
            </div>
        </div>

        <div class="sidebar-item" onclick="toggleSubmenu('colecciones')">
            <div class="sidebar-title">‚≠ê Colecciones</div>
            <div class="sidebar-submenu" id="submenu-colecciones">
                <div class="submenu-item" onclick="filterProducts('', 'nuevos')">Nuevos</div>
                <div class="submenu-item" onclick="filterProducts('', 'descuentos')">Descuentos</div>
                <div class="submenu-item" onclick="filterProducts('', 'favoritos')">Favoritos</div>
            </div>
        </div>

        <div class="sidebar-item">
            <div class="sidebar-title">‚ÑπÔ∏è Sobre Nosotros</div>
        </div>

        <div class="sidebar-item">
            <div class="sidebar-title">üìû Contacto</div>
        </div>
    </nav>

    

    <!-- Entry Modal (choose mode) -->
    <div class="entry-modal" id="entryModal">
        <div class="entry-content">
            <h2>Selecciona un modo</h2>
            <p>Elige si deseas usar la aplicaci√≥n como cliente o como administrador.</p>
            <div class="entry-buttons">
                <button class="entry-btn" onclick="selectMode('client')">Modo Cliente</button>
                <button class="entry-btn secondary" onclick="selectMode('admin')">Modo Administrador</button>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="auth-modal" id="searchModal">
        <div class="auth-content" style="max-width:480px; width:95%;">
            <span class="close-modal" onclick="closeSearchModal()">&times;</span>
            <h2>Buscar productos</h2>
            <div class="form-group">
                <label>Buscar</label>
                <input type="text" id="headerSearchInput" placeholder="Escribe el nombre del producto...">
            </div>
            <div style="display:flex; gap:0.5rem; margin-top:1rem;">
                <button class="btn btn-primary" onclick="performSearchFromModal()">Buscar</button>
                <button class="btn" onclick="closeSearchModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <span class="close-modal" onclick="closeAuthModal()">&times;</span>
            <h2>Bienvenido a StreetWearX</h2>
            
            <div class="auth-tabs">
                <button id="authTab-login" class="auth-tab active" onclick="switchAuthTab('login')">Iniciar Sesi√≥n</button>
                <button id="authTab-admin" class="auth-tab" onclick="switchAuthTab('admin')">Administrador</button>
            </div>

            <!-- Login Tab -->
            <div id="login-tab" class="auth-tab-content active">
                <div class="form-group">
                    <label>Nombre o Email</label>
                    <input type="text" id="loginEmail" placeholder="Eduardo">
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn btn-primary" onclick="loginUser()">Iniciar Sesi√≥n</button>
            </div>

            <!-- Admin Tab -->
            <div id="admin-tab" class="auth-tab-content">
                <div class="form-group">
                    <label>Nombre de Administrador</label>
                    <input type="text" id="adminName" placeholder="Tu Nombre">
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn btn-primary" onclick="loginAdmin()">Entrar como Admin</button>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <button class="cart-close-btn" onclick="toggleCart()" aria-label="Cerrar carrito">‚úï</button>
        <div class="cart-header">
            <h2>Tu Carrito</h2>
            <button class="icon-btn" onclick="toggleCart()" style="color: white;">‚úï</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">Tu carrito est√° vac√≠o</div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="btn-checkout" onclick="checkout()">Proceder al Pago</button>
        </div>
    </div>

    <!-- Admin Panel Modal -->
        <div class="admin-panel" id="adminPanel">
                <div class="admin-content">
                        <span class="close-modal" onclick="closeAdminPanel()">&times;</span>
                        <h2>Panel de Administraci√≥n - StreetWearX</h2>
                        <div class="form-group" style="margin-bottom:10px;">
                                <label>Tallas (coma-separadas)</label>
                                <input type="text" id="productSizes" placeholder="Ej: S,M,L,XL (dejar vac√≠o si no aplica)">
                                <small style="display:block; color:#666; margin-top:6px;">Escribe las tallas separadas por comas.</small>
                        </div>
                        <div class="admin-tabs">
                            <button class="admin-tab-btn active" onclick="switchAdminTab('products', this)">Productos</button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('orders', this)">√ìrdenes</button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('stats', this)">Estad√≠sticas</button>
                        </div>

                        <div id="products-tab" class="admin-tab-content active">
                        <h3 style="margin-bottom: 1rem;">Agregar / Editar Productos</h3>
                        <div class="form-grid" style="margin-bottom:12px; display:block">
                                <div class="admin-form" style="padding:0; box-shadow:none; border:0; gap:12px; grid-template-columns: 1fr 300px;">
                                    <div class="form-left">
                                        <div class="form-row">
                                            <label>Nombre del Producto</label>
                                            <input type="text" id="productName" placeholder="Ej: Camiseta Urban">
                                        </div>
                                        <div class="form-row">
                                            <label>Categor√≠a</label>
                                            <select id="productCategory">
                                                <option>hombres-camisetas</option>
                                                <option>hombres-pantalones</option>
                                                <option>hombres-sudaderas</option>
                                                <option>hombres-accesorios</option>
                                                <option>mujeres-camisetas</option>
                                                <option>mujeres-pantalones</option>
                                                <option>mujeres-sudaderas</option>
                                                <option>mujeres-accesorios</option>
                                                <option>unisex-gorras</option>
                                                <option>unisex-mochilas</option>
                                                <option>unisex-zapatos</option>
                                                <option>unisex-accesorios</option>
                                            </select>
                                        </div>
                                        <div style="display:flex; gap:8px;">
                                            <div style="flex:1" class="form-row">
                                                <label>Precio</label>
                                                <input type="number" id="productPrice" placeholder="29.99">
                                            </div>
                                            <div style="width:120px" class="form-row">
                                                <label>Stock</label>
                                                <input type="number" id="productStock" placeholder="50">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <label>Descripci√≥n</label>
                                            <input type="text" id="productDescription" placeholder="Descripci√≥n del producto">
                                        </div>
                                    </div>
                                    <div class="form-right">
                                        <div class="form-row">
                                            <label>Im√°genes del Producto (hasta 6)</label>
                                            <input type="file" id="productImages" accept="image/*" multiple placeholder="Selecciona im√°genes">
                                            <small style="display:block; color:#666; margin-top:6px;">Puedes seleccionar varias im√°genes. La primera ser√° la principal.</small>
                                        </div>
                                        <div class="form-row">
                                            <label>Previsualizaci√≥n</label>
                                            <div id="productImagePreviews" class="image-previews" aria-live="polite"></div>
                                        </div>
                                        <div style="display:flex; gap:8px; margin-top:8px;">
                                            <button id="saveProductBtn" class="btn btn-primary" style="flex:1;" onclick="addProduct()">+ Agregar Producto</button>
                                            <button id="cancelEditBtn" class="btn btn-secondary" style="display:none">Cancelar edici√≥n</button>
                                        </div>
                                        <div id="editSuccess" class="edit-status" style="display:none">Guardado correctamente.</div>
                                    </div>
                                </div>
                        </div>

                

                <!-- Admin: Existing products list -->
                <h3 style="margin: 1.5rem 0 1rem 0;">Productos Publicados</h3>
                <div id="adminProductsList">
                    <p>Cargando productos...</p>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="orders-tab" class="admin-tab-content">
                <h3>√ìrdenes Recientes</h3>
                <div id="ordersList" style="margin-top: 1rem;">
                    <p>Cargando √≥rdenes...</p>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="stats-tab" class="admin-tab-content">
                <h3>Estad√≠sticas</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: var(--light); padding: 1rem; border-radius: 5px;">
                        <p style="color: #999;">Total de Productos</p>
                        <p style="font-size: 2rem; font-weight: bold; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="totalProducts">0</p>
                    </div>
                    <div style="background: var(--light); padding: 1rem; border-radius: 5px;">
                        <p style="color: #999;">Total de √ìrdenes</p>
                        <p style="font-size: 2rem; font-weight: bold; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="totalOrders">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main>
        <!-- Compact Promotional Banner -->
        <div class="compact-banner" role="region" aria-label="Promoci√≥n">
            <div class="banner-inner">
                <div>
                    <h2>Oferta Especial: Env√≠o Gratis esta Semana</h2>
                    <p>Descuentos exclusivos en nuevas colecciones ‚Äî ¬°hasta 30% OFF!</p>
                </div>
                <div>
                    <button class="btn cta" onclick="document.getElementById('productsSection').scrollIntoView({behavior:'smooth'})">Ver Productos</button>
                </div>
            </div>
        </div>

        <!-- Product Carousel -->
        <div class="carousel-container" id="carouselContainer">
            <div class="carousel-header">
                <h3>Productos Destacados</h3>
                <div class="carousel-controls">
                    <button class="carousel-btn" onclick="scrollCarousel(-1)" aria-label="Anterior">‚ùÆ</button>
                    <button class="carousel-btn" onclick="scrollCarousel(1)" aria-label="Siguiente">‚ùØ</button>
                </div>
            </div>
            <div class="carousel-wrapper">
                <div class="carousel-slides" id="carouselSlides">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="filter-section">
            <select id="categoryFilter" onchange="applyFilters()">
                <option value="">Todas las Categor√≠as</option>
                <option value="hombres">Hombres</option>
                <option value="mujeres">Mujeres</option>
                <option value="unisex">Unisex</option>
            </select>
            <input type="text" id="searchInput" placeholder="Buscar productos..." onkeyup="applyFilters()" style="padding: 0.75rem; border: 1px solid var(--border); border-radius: 0; flex: 1; max-width: 300px;">
        </div>

        <div id="productsSection" class="products-grid" style="padding: 0 2rem;">
            <div class="loading">
                <div class="spinner"></div>
                <p>Cargando productos...</p>
            </div>
        </div>
    </main>

    <!-- Product Detail Modal -->
    <div class="auth-modal" id="productModal" style="z-index:320;">
        <div class="auth-content" style="max-width:900px; width:95%; display:flex; gap:1rem; align-items:flex-start;">
            <span class="close-modal" onclick="closeProductModal()" style="right:12px;">&times;</span>
            <div style="flex:1; min-width:300px;">
                <div id="productMainImage" style="width:100%; height:450px; background:#f5f5f5; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                    <img id="productMainImgTag" src="https://via.placeholder.com/700x450" style="width:100%; height:100%; object-fit:cover;" onerror="this.src='https://via.placeholder.com/700x450'">
                </div>
                <div id="productThumbnails" style="display:flex; gap:0.5rem; margin-top:0.8rem; overflow-x:auto;"></div>
            </div>
            <div style="width:380px;">
                <h2 id="modalProductName">Producto</h2>
                <p id="modalProductCategory" style="color:#666; font-weight:700; text-transform:uppercase; font-size:0.9rem"></p>
                <p id="modalProductPrice" style="font-size:1.25rem; color:var(--primary); font-weight:800; margin-top:0.6rem"></p>
                <div class="form-group" style="margin-top:0.6rem;">
                    <label>Talla</label>
                    <select id="modalProductSizeSelect" style="width:100%; padding:0.6rem;">
                        <option value="">Selecciona talla</option>
                    </select>
                </div>
                <p id="modalProductDesc" style="margin-top:1rem; color:#333"></p>
                <p id="modalProductStock" style="margin-top:0.5rem; color:#666"></p>
                <div style="margin-top:1.2rem; display:flex; gap:0.5rem;">
                    <button class="btn btn-primary" id="modalAddCartBtn">Agregar al Carrito</button>
                    <button class="btn" onclick="closeProductModal()">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Config & Scripts -->
    <script type="module">
        // Reemplaza con tu configuraci√≥n de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
      import {
  getFirestore,
  collection,
  getDocs,
  getDocsFromCache,
  addDoc,
  deleteDoc,
  doc,
  enableIndexedDbPersistence
} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        // CONFIGURACI√ìN DE FIREBASE - REEMPLAZA CON TUS CREDENCIALES
        const firebaseConfig = {
           apiKey: "AIzaSyB-Ag7WIUBcGgJPBg6taUqtGVHgWAwekhY",
            authDomain: "proyect1-37d04.firebaseapp.com",
            projectId: "proyect1-37d04",
            storageBucket: "proyect1-37d04.firebasestorage.app",
            messagingSenderId: "989990045683",
            appId: "1:989990045683:web:778984a898aa4046097486",
            measurementId: "G-WBQ6DYGRG8"
        };

        // CONFIGURACI√ìN DE CLOUDINARY - REEMPLAZA CON TUS CREDENCIALES
        const cloudinaryConfig = {
            cloudName: "dv5pdjhso",
            uploadPreset: "streetwearx_unsigned"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // =========================
// IndexedDB para modo OFFLINE
// =========================
let dbIDB;
const request = indexedDB.open("streetwearXDB", 1);

request.onupgradeneeded = function (event) {
  dbIDB = event.target.result;
  if (!dbIDB.objectStoreNames.contains("products")) {
    dbIDB.createObjectStore("products", { keyPath: "id" });
  }
};

request.onsuccess = function (event) {
  dbIDB = event.target.result;
  console.log("IndexedDB lista ‚úî");
};

function saveProductsToIDB(products) {
  return new Promise((resolve) => {
    const tx = dbIDB.transaction("products", "readwrite");
    const store = tx.objectStore("products");
    store.clear();
    products.forEach((p) => store.put(p));
    tx.oncomplete = resolve;
  });
}

function getProductsFromIDB() {
  return new Promise((resolve) => {
    const tx = dbIDB.transaction("products", "readonly");
    const store = tx.objectStore("products");
    const req = store.getAll();
    req.onsuccess = () => resolve(req.result);
  });
}
// üî• Activar modo offline de Firestore (admin + clientes)
enableIndexedDbPersistence(db).catch((err) => {
  console.warn('No se pudo activar la persistencia offline de Firestore:', err.code || err);
});
        // Variables Globales
        window.currentUser = null;
        window.isAdmin = false;
        window.cart = JSON.parse(localStorage.getItem('cart')) || [];
        window.allProducts = [];
        window.filteredProducts = [];

        // Monitorear estado de autenticaci√≥n
        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            if (user) {
                document.getElementById('userBtn').textContent = '‚úì';
                document.getElementById('userBtn').title = user.email;
                checkAdminStatus(user);
            } else {
                document.getElementById('userBtn').textContent = 'üë§';
                window.isAdmin = false;
            }
        });

        // Global error handlers to help debugging when page hangs
        window.onerror = function(message, source, line, col, error) {
            console.error('Global error:', message, 'at', source + ':' + line + ':' + col, error);
            const s = document.getElementById('appStatus'); if (s) s.textContent = 'Error: ' + message;
            showToast('Error: ' + message, 'error');
        };

        window.addEventListener('unhandledrejection', function(evt) {
            console.error('Unhandled rejection:', evt.reason);
            const s = document.getElementById('appStatus'); if (s) s.textContent = 'Error promise: ' + (evt.reason && evt.reason.message ? evt.reason.message : evt.reason);
            showToast('Error interno: ' + (evt.reason && evt.reason.message ? evt.reason.message : evt.reason), 'error');
        });

        // Funci√≥n para verificar si es administrador
        async function checkAdminStatus(user) {
            try {
                const adminRef = collection(db, 'admins');
                const q = query(adminRef, where('email', '==', user.email));
                const querySnapshot = await getDocs(q);
                window.isAdmin = !querySnapshot.empty;
            } catch (error) {
                console.error('Error verificando admin:', error);
            }
        }

        // Auth Functions
        window.loginUser = async function() {
            const identifier = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            // If user provided an email-like identifier, try Firebase auth first
            if (identifier.includes('@')) {
                try {
                    await signInWithEmailAndPassword(auth, identifier, password);
                    window.isAdmin = false;
                    showToast('Sesi√≥n iniciada correctamente');
                    closeAuthModal();
                    return;
                } catch (error) {
                    // fallthrough to try Firestore users by name/password
                    console.warn('Firebase login failed, trying local users:', error.message);
                }
            }

            // Fallback: allow client login using only the name (password can be any value)
            try {
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where('name', '==', identifier));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const docData = querySnapshot.docs[0].data();
                    window.currentUser = { name: docData.name, uid: docData.uid || querySnapshot.docs[0].id, role: docData.role || 'customer' };
                    window.isAdmin = false;
                    document.getElementById('userBtn').textContent = '‚úì';
                    document.getElementById('userBtn').title = docData.name;
                    showToast('Sesi√≥n iniciada correctamente');
                    updateUIForRole();
                    closeAuthModal();
                } else {
                    // If user doesn't exist, create it automatically (no password check)
                    const newUserRef = await addDoc(collection(db, 'users'), {
                        name: identifier,
                        role: 'customer',
                        createdAt: new Date()
                    });
                    window.currentUser = { name: identifier, uid: newUserRef.id, role: 'customer' };
                    window.isAdmin = false;
                    document.getElementById('userBtn').textContent = '‚úì';
                    document.getElementById('userBtn').title = identifier;
                    showToast('Cuenta creada e iniciada como cliente');
                    updateUIForRole();
                    closeAuthModal();
                }
            } catch (error) {
                showToast(error.message, 'error');
            }
        };



        window.loginAdmin = async function() {
            const name = (document.getElementById('adminName')) ? document.getElementById('adminName').value.trim() : '';
            const password = document.getElementById('adminPassword').value;

            // Admin password must be exactly 'streetwear'
            if (password === 'streetwear') {
                window.isAdmin = true;
                window.currentUser = { name: name || 'Administrador', uid: 'local-admin', role: 'admin' };
                document.getElementById('userBtn').textContent = 'ADM';
                document.getElementById('userBtn').title = name || 'Administrador';
                showToast('Bienvenido Administrador');
                updateUIForRole();
                closeAuthModal();
                openAdminPanel();
                return;
            }

            showToast('Contrase√±a de administrador incorrecta', 'error');
        };

        // Product Functions
        window.addProduct = async function() {
            if (!window.isAdmin) {
                showToast('No tienes permisos para agregar productos', 'error');
                return;
            }

            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const description = document.getElementById('productDescription').value;
            const imageFiles = Array.from(document.getElementById('productImages').files || []);

            if (!name || !price || !stock) {
                showToast('Completa todos los campos obligatorios', 'error');
                return;
            }

            // Note: require images only when creating a new product. Editing can skip uploading new images.

            try {
                showToast('Subiendo imagen a Cloudinary...');
                
                // Upload image to Cloudinary
                // If editing an existing product, we'll update it; otherwise create new
                const editingId = window.editingProductId || null;
                // Require at least one image when creating a new product (editing may skip images)
                if (!editingId && imageFiles.length === 0) {
                    showToast('Selecciona al menos una imagen para el producto', 'error');
                    return;
                }
                let imageUrl = null;
                let cloudinaryPublicId = null;

                // Prepare arrays for any uploads
                let urls = [];
                let publicIds = [];
                let imageUrlsArray = undefined;
                let cloudinaryPublicIdsArray = undefined;

                // If new image files were provided, upload them. If editing and no new images, we'll keep existing meta.
                if (imageFiles.length > 0) {
                    for (let i = 0; i < imageFiles.length && i < 6; i++) {
                        const file = imageFiles[i];
                        const formData = new FormData();
                        formData.append('file', file);
                        formData.append('upload_preset', cloudinaryConfig.uploadPreset);

                        const uploadResponse = await fetch(
                            `https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/upload`,
                            {
                                method: 'POST',
                                body: formData
                            }
                        );

                        if (!uploadResponse.ok) {
                            throw new Error('Error al subir imagenes a Cloudinary');
                        }

                        const uploadData = await uploadResponse.json();
                        urls.push(uploadData.secure_url);
                        publicIds.push(uploadData.public_id);
                    }
                    imageUrl = urls[0];
                    cloudinaryPublicId = publicIds[0];
                    // use arrays for storage
                    imageUrlsArray = urls;
                    cloudinaryPublicIdsArray = publicIds;
                }

                // Parse sizes input (comma separated)
                const sizesInput = document.getElementById('productSizes').value || '';
                const sizesArray = sizesInput.split(',').map(s => s.trim()).filter(Boolean);

                showToast(editingId ? 'Actualizando producto en base de datos...' : 'Guardando producto en base de datos...');

                if (editingId) {
                    const productRef = doc(db, 'products', editingId);
                    const updatePayload = {
                        name,
                        category,
                        price,
                        stock,
                        description,
                        sizes: sizesArray,
                        updatedAt: new Date()
                    };

                    // Build final arrays respecting existing edited meta and newly uploaded images.
                    const existingMeta = (window.editingExistingImagesMeta && Array.isArray(window.editingExistingImagesMeta)) ? window.editingExistingImagesMeta : [];
                    let finalImageUrls = existingMeta.map(m => m.url);
                    let finalPublicIds = existingMeta.map(m => m.publicId);

                    if (imageUrlsArray && imageUrlsArray.length > 0) {
                        const space = Math.max(0, 6 - finalImageUrls.length);
                        const appendUrls = imageUrlsArray.slice(0, space);
                        const appendIds = cloudinaryPublicIdsArray.slice(0, space);
                        finalImageUrls = finalImageUrls.concat(appendUrls);
                        finalPublicIds = finalPublicIds.concat(appendIds);
                    }

                    // If there are final images (either existing or newly uploaded), set them in update.
                    if (finalImageUrls.length > 0) {
                        updatePayload.imageUrls = finalImageUrls;
                        updatePayload.cloudinaryPublicIds = finalPublicIds;
                        updatePayload.imageUrl = finalImageUrls[0];
                        updatePayload.cloudinaryPublicId = finalPublicIds[0] || null;
                    }

                    await updateDoc(productRef, updatePayload);
                    showToast('Producto actualizado correctamente');
                    window.editingProductId = null;
                    // clear editing meta after successful save
                    window.editingExistingImagesMeta = [];
                } else {
                    // Save product to Firestore with Cloudinary image URL
                    const newDoc = await addDoc(collection(db, 'products'), {
                        name,
                        category,
                        price,
                        stock,
                        description,
                        sizes: sizesArray,
                        imageUrl: imageUrl,
                        cloudinaryPublicId: cloudinaryPublicId,
                        imageUrls: imageUrlsArray || (imageUrl ? [imageUrl] : []),
                        cloudinaryPublicIds: cloudinaryPublicIdsArray || (cloudinaryPublicId ? [cloudinaryPublicId] : []),
                        createdAt: new Date(),
                        rating: 0,
                        reviews: 0
                    });
                    showToast('Producto agregado exitosamente');
                }

                // Reset form and show inline success
                resetAdminForm();
                const success = document.getElementById('editSuccess'); if (success) { success.style.display = 'block'; setTimeout(()=>{ success.style.display = 'none'; }, 3000); }

                await loadProducts();
                await loadAdminProducts();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error('Error en addProduct:', error);
            }
        
        };

// üöÄ Load Products con soporte OFFLINE + actualizaci√≥n UI
async function loadProducts() {
  const s = document.getElementById('appStatus');
  if (s) s.textContent = 'Cargando productos...';

  try {
    // 1. Intentar obtener productos ONLINE de Firebase
    const querySnapshot = await getDocs(collection(db, 'products'));
    window.allProducts = [];

    querySnapshot.forEach((docSnap) => {
      window.allProducts.push({
        id: docSnap.id,
        ...docSnap.data()
      });
    });

    // Guardar offline
    await saveProductsToIDB(window.allProducts);

    if (s) s.textContent = 'Productos cargados (online)';
    console.log("Productos cargados desde Firebase ‚úî");

  } catch (error) {

    console.warn("No hay conexi√≥n, cargando desde IndexedDB‚Ä¶");

    // 2. Cargar desde IndexedDB (OFFLINE)
    const localProducts = await getProductsFromIDB();

    if (localProducts && localProducts.length > 0) {
      window.allProducts = localProducts;
      if (s) s.textContent = 'Productos cargados (offline)';
      console.log("Productos cargados offline ‚úî");
    } else {
      console.error("No hay productos guardados offline ‚ùå");
      window.allProducts = [];
      if (s) s.textContent = "No se pudieron cargar productos.";
    }
  }

  // 3. Actualizar filtros + UI
  window.filteredProducts = window.allProducts;
  window.currentSubcategoryFilter = "";

  displayProducts(window.filteredProducts);
  renderCarousel();

  const s2 = document.getElementById('appStatus');
  if (s2) s2.textContent = 'Productos cargados: ' + window.allProducts.length;

  // Cargar panel admin si aplica
  if (window.isAdmin) {
    await loadAdminProducts();
  }
}

        // Render previews when files are selected in the admin form
        const productImagesInput = document.getElementById('productImages');
        if (productImagesInput) {
            productImagesInput.addEventListener('change', (e) => {
                const previews = document.getElementById('productImagePreviews');
                previews.innerHTML = '';
                const files = Array.from(e.target.files || []);
                files.slice(0,6).forEach((file, idx) => {
                    const url = URL.createObjectURL(file);
                    const img = document.createElement('img');
                    img.src = url;
                    img.className = 'thumb-img';
                    img.title = file.name;
                    previews.appendChild(img);
                });
            });
        }

        // Render existing previews (editable) when in edit mode
        function renderExistingPreviews() {
            const previews = document.getElementById('productImagePreviews');
            if (!previews) return;
            previews.innerHTML = '';
            const meta = window.editingExistingImagesMeta || [];
            meta.slice(0,6).forEach((m, idx) => {
                const wrap = document.createElement('div');
                wrap.className = 'preview-wrap';

                const img = document.createElement('img');
                img.src = m.url;
                img.className = 'thumb-img';
                img.alt = 'Imagen ' + (idx+1);
                wrap.appendChild(img);

                // Primary badge for first image
                if (idx === 0) {
                    const badge = document.createElement('div');
                    badge.className = 'primary-badge';
                    badge.textContent = 'Principal';
                    wrap.appendChild(badge);
                }

                // Overlay controls
                const overlay = document.createElement('div');
                overlay.className = 'thumb-overlay';
                const btnGroup = document.createElement('div');

                const makePrimary = document.createElement('button');
                makePrimary.className = 'thumb-btn';
                makePrimary.textContent = 'Principal';
                makePrimary.title = 'Marcar como principal';
                makePrimary.addEventListener('click', (ev) => {
                    ev.stopPropagation();
                    // move this item to front
                    window.editingExistingImagesMeta.splice(0,0, window.editingExistingImagesMeta.splice(idx,1)[0]);
                    renderExistingPreviews();
                });

                const removeBtn = document.createElement('button');
                removeBtn.className = 'thumb-btn';
                removeBtn.style.marginLeft = '6px';
                removeBtn.textContent = 'Eliminar';
                removeBtn.title = 'Eliminar imagen existente';
                removeBtn.addEventListener('click', (ev) => {
                    ev.stopPropagation();
                    if (!confirm('Eliminar esta imagen del producto?')) return;
                    window.editingExistingImagesMeta.splice(idx,1);
                    renderExistingPreviews();
                });

                btnGroup.appendChild(makePrimary);
                btnGroup.appendChild(removeBtn);
                overlay.appendChild(btnGroup);
                wrap.appendChild(overlay);

                previews.appendChild(wrap);
            });
        }

        // Helper to reset admin form and UI state
        function resetAdminForm() {
                window.editingProductId = null;
                // clear any in-memory existing images meta used for edit mode
                window.editingExistingImagesMeta = [];
            const fields = ['productName','productCategory','productPrice','productStock','productDescription','productSizes','productImages'];
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA') el.value = '';
            });
            const previews = document.getElementById('productImagePreviews'); if (previews) previews.innerHTML = '';
            const saveBtn = document.getElementById('saveProductBtn'); if (saveBtn) saveBtn.textContent = '+ Agregar Producto';
            const cancelBtn = document.getElementById('cancelEditBtn'); if (cancelBtn) cancelBtn.style.display = 'none';
            const status = document.getElementById('editFormStatus'); if (status) status.textContent = '';
            const success = document.getElementById('editSuccess'); if (success) success.style.display = 'none';
        }

        // Attach cancel edit handler
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        if (cancelEditBtn) {
            cancelEditBtn.addEventListener('click', (e) => {
                e.preventDefault();
                resetAdminForm();
                showToast('Edici√≥n cancelada');
            });
        }

        // Display Products
        function displayProducts(products) {
            const grid = document.getElementById('productsSection');
            
            if (products.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem;">No se encontraron productos</div>';
                return;
            }

            grid.innerHTML = products.map(product => `
                <div class="product-card" onclick="openProductModal('${product.id}')">
                    <img src="${(product.imageUrls && product.imageUrls[0]) || product.imageUrl || 'https://via.placeholder.com/250'}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/250'">
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-category">${product.category}</div>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                        <div class="product-rating">‚≠ê ${(product.rating || 0).toFixed(1)} (${product.reviews || 0} rese√±as)</div>
                        <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart('${product.id}', '${product.name}', ${product.price}, '${((product.imageUrls && product.imageUrls[0]) || product.imageUrl) || ''}')">
                            Agregar al Carrito
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Filter & Search
        window.applyFilters = function() {
            const category = document.getElementById('categoryFilter').value.toLowerCase();
            const search = document.getElementById('searchInput').value.toLowerCase();
            const subcategory = (window.currentSubcategoryFilter || '').toLowerCase();

            window.filteredProducts = window.allProducts.filter(product => {
                const prodCat = (product.category || '').toLowerCase();
                const matchesCategory = !category || prodCat.includes(category);
                const matchesSub = !subcategory || prodCat.includes(subcategory);
                const pname = (product.name || '').toLowerCase();
                const pdesc = (product.description || '').toLowerCase();
                const matchesSearch = !search || pname.includes(search) || pdesc.includes(search);
                return matchesCategory && matchesSub && matchesSearch;
            });

            displayProducts(window.filteredProducts);
        };

        window.filterProducts = function(category, subcategory) {
            // category = top-level (hombres|mujeres|unisex) ; subcategory = specific (camisetas|pantalones|accesorios...)
            closeSidebar();
            // set top-level filter control if present
            const catEl = document.getElementById('categoryFilter');
            if (catEl) catEl.value = category || '';
            // set subcategory in memory and clear search input
            window.currentSubcategoryFilter = subcategory || '';
            const searchEl = document.getElementById('searchInput');
            if (searchEl) searchEl.value = '';
            window.applyFilters();

            // Highlight the selected submenu item and the parent category
            // Clear previous highlights
            document.querySelectorAll('.submenu-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(si => si.classList.remove('selected'));

            // Highlight matching submenu items (match by text content)
            if (subcategory) {
                const normalized = (subcategory || '').toLowerCase();
                document.querySelectorAll('.submenu-item').forEach(el => {
                    if ((el.textContent || '').trim().toLowerCase() === normalized) {
                        el.classList.add('active');
                        // Also mark its parent sidebar-item as selected
                        const parent = el.closest('.sidebar-submenu');
                        if (parent && parent.parentElement) parent.parentElement.classList.add('selected');
                    }
                });
            } else if (category) {
                // If no subcategory, highlight the top-level category container
                const normalizedCat = (category || '').toLowerCase();
                document.querySelectorAll('.sidebar-item').forEach(si => {
                    const title = (si.querySelector('.sidebar-title') && si.querySelector('.sidebar-title').textContent) || '';
                    if (title.toLowerCase().includes(normalizedCat)) si.classList.add('selected');
                });
            }

            // After filtering and highlighting, scroll smoothly to products section
            setTimeout(() => {
                const productsSection = document.getElementById('productsSection');
                if (productsSection) {
                    productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                const firstProduct = document.querySelector('.product-card');
                if (firstProduct) {
                    // center the first product in view for emphasis
                    firstProduct.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 120);
        };

        // Ensure when the top-level category select is changed manually we clear any subcategory filter
        const categoryFilterEl = document.getElementById('categoryFilter');
        if (categoryFilterEl) {
            categoryFilterEl.addEventListener('change', () => {
                window.currentSubcategoryFilter = '';
                window.applyFilters();
            });
        }

        // Cart Functions
        window.addToCart = function(productId, productName, productPrice, productImage, productSize) {
            const existingItem = window.cart.find(item => item.id === productId && item.size === (productSize || ''));
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                window.cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    size: productSize || '',
                    quantity: 1
                });
            }

            saveCart();
            updateCartUI();
            showToast('¬°Producto agregado al carrito!');
        };

        window.removeFromCart = function(productId, size) {
            window.cart = window.cart.filter(item => !(item.id === productId && (item.size || '') === (size || '')));
            saveCart();
            updateCartUI();
        };

        window.updateCartQuantity = function(productId, change, size) {
            const item = window.cart.find(it => it.id === productId && (it.size || '') === (size || ''));
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    window.removeFromCart(productId, size);
                } else {
                    saveCart();
                    updateCartUI();
                }
            }
        };

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(window.cart));
        }

        function updateCartUI() {
            const count = window.cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;

            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            if (window.cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart">Tu carrito est√° vac√≠o</div>';
                cartTotal.textContent = '$0.00';
                return;
            }

            const total = window.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotal.textContent = '$' + total.toFixed(2);

            cartItems.innerHTML = window.cart.map(item => `
                <div class="cart-item">
                    <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}" class="cart-item-img" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">$${item.price.toFixed(2)} ${item.size ? '¬∑ Talla: ' + item.size : ''}</div>
                        <div class="cart-item-qty">
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', -1, '${item.size || ''}')">‚àí</button>
                            <span>${item.quantity}</span>
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', 1, '${item.size || ''}')">+</button>
                        </div>
                    </div>
                    <button class="cart-remove" onclick="removeFromCart('${item.id}', '${item.size || ''}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        window.checkout = function() {
            if (window.cart.length === 0) {
                showToast('El carrito est√° vac√≠o', 'error');
                return;
            }

            if (!window.currentUser) {
                showToast('Por favor inicia sesi√≥n para continuar', 'error');
                openAuthModal();
                return;
            }

            showToast('Redirigiendo a pago... (Funcionalidad de pago aqu√≠)');
            // Aqu√≠ integrar√≠a Stripe, PayPal o tu proveedor de pagos
        };

        // UI Functions
        window.openAuthModal = function() {
            const el = document.getElementById('authModal'); if (el) el.classList.add('active');
        };

        window.closeAuthModal = function() {
            const el = document.getElementById('authModal'); if (el) el.classList.remove('active');
            // Limpiar campos
            document.querySelectorAll('input[type="email"], input[type="password"], input[type="text"]').forEach(input => {
                if (input.id.includes('login') || input.id.includes('register') || input.id.includes('admin')) {
                    input.value = '';
                }
            });
        };

        window.switchAuthTab = function(tab) {
            document.querySelectorAll('.auth-tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.auth-tab').forEach(el => el.classList.remove('active'));

            const content = document.getElementById(tab + '-tab');
            if (content) content.classList.add('active');

            const tabBtn = document.getElementById('authTab-' + tab);
            if (tabBtn) tabBtn.classList.add('active');
        };

        // Entry modal control
        window.openEntryModal = function() {
            const el = document.getElementById('entryModal'); if (el) el.classList.add('active');
        };

        window.closeEntryModal = function() {
            const el = document.getElementById('entryModal'); if (el) el.classList.remove('active');
        };

        window.selectMode = function(mode) {
            closeEntryModal();
            openAuthModal();
            if (mode === 'admin') {
                switchAuthTab('admin');
            } else {
                switchAuthTab('login');
            }
        };

        // Update UI based on user role
        window.updateUIForRole = function() {
            if (window.isAdmin) {
                // Admin: show admin controls, hide client shopping
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
                document.querySelectorAll('.client-only').forEach(el => el.classList.add('hidden'));
                const modeBtn = document.getElementById('modeBtn');
                if (modeBtn) modeBtn.textContent = 'Modo: Admin';
                if (document.getElementById('userBtn')) document.getElementById('userBtn').textContent = 'ADM';
            } else {
                // Client: show client shopping, hide admin controls
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.client-only').forEach(el => el.classList.remove('hidden'));
                const modeBtn = document.getElementById('modeBtn');
                if (modeBtn) modeBtn.textContent = 'Modo: Cliente';
                if (document.getElementById('userBtn')) document.getElementById('userBtn').textContent = window.currentUser && window.currentUser.name ? window.currentUser.name.charAt(0).toUpperCase() : 'üë§';
            }
        };

        // Show entry modal on load (if no user signed in)
        window.addEventListener('load', () => {
            // If there's already an authenticated user, skip entry modal
            if (!window.currentUser) {
                openEntryModal();
            }
        });

        window.toggleCart = function() {
            const el = document.getElementById('cartModal'); if (el) el.classList.toggle('active');
        };

        window.openAdminPanel = function() {
            const el = document.getElementById('adminPanel'); if (el) el.classList.add('active');
            loadAdminStats();
            loadAdminProducts();
        };

        window.closeAdminPanel = function() {
            const el = document.getElementById('adminPanel'); if (el) el.classList.remove('active');
        };

        window.switchAdminTab = function(tab, btn) {
            document.querySelectorAll('.admin-tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.admin-tab-btn').forEach(el => el.classList.remove('active'));

            const targetContent = document.getElementById(tab + '-tab');
            if (targetContent) targetContent.classList.add('active');

            if (btn && btn.classList) {
                btn.classList.add('active');
            } else {
                // fallback: try to find a button that contains the tab name
                const fallback = Array.from(document.querySelectorAll('.admin-tab-btn')).find(b => (b.textContent || '').toLowerCase().includes(tab));
                if (fallback && fallback.classList) fallback.classList.add('active');
            }

            if (tab === 'orders') loadOrders();
            if (tab === 'stats') loadAdminStats();
        };

        async function loadOrders() {
            try {
                const querySnapshot = await getDocs(collection(db, 'orders'));
                const orders = [];
                querySnapshot.forEach((doc) => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                const ordersList = document.getElementById('ordersList');
                if (orders.length === 0) {
                    ordersList.innerHTML = '<p>No hay √≥rdenes a√∫n</p>';
                } else {
                    ordersList.innerHTML = orders.map(order => `
                        <div style="padding: 1rem; border: 1px solid var(--border); border-radius: 5px; margin-bottom: 1rem;">
                            <p><strong>Orden ID:</strong> ${order.id}</p>
                            <p><strong>Cliente:</strong> ${order.customerEmail}</p>
                            <p><strong>Total:</strong> $${order.total.toFixed(2)}</p>
                            <p><strong>Fecha:</strong> ${order.createdAt.toDate().toLocaleDateString()}</p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error cargando √≥rdenes:', error);
            }
        }

        // Load products specifically for admin management
        async function loadAdminProducts() {
            try {
                const querySnapshot = await getDocs(collection(db, 'products'));
                const products = [];
                querySnapshot.forEach((docSnap) => {
                    products.push({ id: docSnap.id, ...docSnap.data() });
                });
                renderAdminProducts(products);
            } catch (error) {
                console.error('Error cargando productos para admin:', error);
                document.getElementById('adminProductsList').innerHTML = '<p>Error cargando productos</p>';
            }
        }

        // Product detail modal functions
        window.openProductModal = function(productId) {
            const prod = window.allProducts.find(p => p.id === productId);
            if (!prod) return showToast('Producto no encontrado', 'error');
            const images = (prod.imageUrls && prod.imageUrls.length) ? prod.imageUrls : (prod.imageUrl ? [prod.imageUrl] : []);
            const mainImgTag = document.getElementById('productMainImgTag');
            const thumbs = document.getElementById('productThumbnails');
            document.getElementById('modalProductName').textContent = prod.name;
            document.getElementById('modalProductCategory').textContent = prod.category;
            document.getElementById('modalProductPrice').textContent = '$' + (prod.price || 0).toFixed(2);
            document.getElementById('modalProductDesc').textContent = prod.description || '';
            document.getElementById('modalProductStock').textContent = 'Stock: ' + (prod.stock || 0);
            // Main image
            mainImgTag.src = images[0] || 'https://via.placeholder.com/700x450';
            // Thumbnails
            thumbs.innerHTML = images.map((src, idx) => `
                <img src="${src}" style="width:80px;height:80px;object-fit:cover;cursor:pointer;border:2px solid transparent" onclick="document.getElementById('productMainImgTag').src='${src}'" onerror="this.src='https://via.placeholder.com/80'">
            `).join('');

            // Populate size selector
            const sizeSelect = document.getElementById('modalProductSizeSelect');
            sizeSelect.innerHTML = '<option value="">Selecciona talla</option>';
            if (prod.sizes && prod.sizes.length) {
                prod.sizes.forEach(sz => {
                    const opt = document.createElement('option'); opt.value = sz; opt.textContent = sz; sizeSelect.appendChild(opt);
                });
            }

            const addBtn = document.getElementById('modalAddCartBtn');
            addBtn.onclick = function() {
                const chosenSize = (sizeSelect && sizeSelect.value) ? sizeSelect.value : '';
                addToCart(prod.id, prod.name, prod.price, images[0] || prod.imageUrl || '', chosenSize);
            };

            const pm = document.getElementById('productModal'); if (pm) pm.classList.add('active');
        };

        window.closeProductModal = function() {
            const pm = document.getElementById('productModal'); if (pm) pm.classList.remove('active');
        };

        function renderAdminProducts(products) {
            const container = document.getElementById('adminProductsList');
            if (!products || products.length === 0) {
                container.innerHTML = '<p>No hay productos publicados</p>';
                return;
            }

            container.innerHTML = products.map(p => `
                <div style="display:flex; gap:1rem; align-items:center; padding:0.8rem; border-bottom:1px solid var(--border)">
                    <img src="${(p.imageUrls && p.imageUrls[0]) || p.imageUrl || 'https://via.placeholder.com/80'}" style="width:80px;height:80px;object-fit:cover;border:1px solid var(--border)" onerror="this.src='https://via.placeholder.com/80'">
                    <div style="flex:1">
                        <div style="font-weight:700; text-transform:uppercase">${p.name}</div>
                        <div style="color:#666; font-size:0.9rem">${p.category} ¬∑ $${(p.price||0).toFixed(2)} ¬∑ Stock: ${p.stock||0}</div>
                    </div>
                    <div style="display:flex; gap:0.5rem;">
                        <button class="btn" style="background:var(--accent); color:white; padding:0.5rem 0.8rem; font-weight:700" onclick="event.stopPropagation(); editProduct('${p.id}')">Editar</button>
                        <button class="btn" style="background:#f44336; color:white; padding:0.5rem 0.8rem; font-weight:700" onclick="event.stopPropagation(); deleteProduct('${p.id}', '${(p.cloudinaryPublicIds && p.cloudinaryPublicIds[0]) || (p.cloudinaryPublicId || '')}')">Borrar</button>
                    </div>
                </div>
            `).join('');
        }

        // Fill the add/edit form with existing product data
        async function editProduct(productId) {
            try {
                const docRef = doc(db, 'products', productId);
                const docSnap = await getDoc(docRef);
                if (!docSnap.exists()) {
                    showToast('Producto no encontrado', 'error');
                    return;
                }

                const prod = { id: docSnap.id, ...docSnap.data() };

                document.getElementById('productName').value = prod.name || '';
                document.getElementById('productCategory').value = prod.category || '';
                document.getElementById('productPrice').value = prod.price || '';
                document.getElementById('productStock').value = prod.stock || '';
                document.getElementById('productDescription').value = prod.description || '';
                document.getElementById('productSizes').value = (prod.sizes && prod.sizes.length) ? prod.sizes.join(',') : '';
                // Note: file inputs cannot be set programmatically for security reasons
                window.editingProductId = productId;
                showToast('Puedes editar los campos y/o subir nuevas im√°genes, luego presiona Guardar cambios');
                // Keep editable copy of existing images with publicIds so admin can remove/reorder
                window.editingExistingImagesMeta = (prod.imageUrls || []).map((u, i) => ({ url: u, publicId: (prod.cloudinaryPublicIds && prod.cloudinaryPublicIds[i]) || null }));
                renderExistingPreviews();
                // Toggle form controls for edit mode
                const saveBtn = document.getElementById('saveProductBtn');
                const cancelBtn = document.getElementById('cancelEditBtn');
                const status = document.getElementById('editFormStatus');
                if (saveBtn) saveBtn.textContent = 'Guardar cambios';
                if (cancelBtn) cancelBtn.style.display = 'inline-block';
                if (status) status.textContent = 'Editando: ' + (prod.name || prod.id);
                // Scroll to top of admin panel to show form
                const adminContent = document.querySelector('#adminPanel .admin-content');
                if (adminContent) adminContent.scrollTop = 0;
            } catch (error) {
                console.error('Error preparando edici√≥n:', error);
                showToast('Error al preparar edici√≥n', 'error');
            }
        }

        // Delete product from Firestore (Cloudinary asset is not removed from client for security reasons)
        async function deleteProduct(productId, cloudinaryPublicId) {
            if (!confirm('¬øSeguro que quieres borrar este producto? Esta acci√≥n no se puede deshacer.')) return;
            try {
                await deleteDoc(doc(db, 'products', productId));
                showToast('Producto eliminado');
                // Remove from local lists and refresh displays
                window.allProducts = window.allProducts.filter(p => p.id !== productId);
                window.filteredProducts = window.filteredProducts.filter(p => p.id !== productId);
                displayProducts(window.filteredProducts);
                await loadAdminProducts();

                // Note: deleting the image from Cloudinary requires a server-side signed request.
                if (cloudinaryPublicId) {
                    console.warn('Cloudinary asset not deleted automatically (requires signed server request):', cloudinaryPublicId);
                }
            } catch (error) {
                console.error('Error borrando producto:', error);
                showToast('Error al borrar producto', 'error');
            }
        }
        // Expose functions to global scope so inline onclick handlers can call them
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        async function loadAdminStats() {
            try {
                const productsSnapshot = await getDocs(collection(db, 'products'));
                const ordersSnapshot = await getDocs(collection(db, 'orders'));
                
                document.getElementById('totalProducts').textContent = productsSnapshot.size;
                document.getElementById('totalOrders').textContent = ordersSnapshot.size;
                // Also refresh admin products list view
                if (window.isAdmin) await loadAdminProducts();
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
            }
        }

        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        };

        // Switch mode between client and admin. When switching to admin, require admin password.
        window.switchMode = async function(mode) {
            if (mode === 'admin') {
                // Ask for admin password
                const pwd = prompt('Ingresa la contrase√±a de administrador:');
                if (pwd === 'streetwear') {
                    window.isAdmin = true;
                    window.currentUser = window.currentUser || { name: 'Administrador', uid: 'local-admin', role: 'admin' };
                    updateUIForRole();
                    openAdminPanel();
                    showToast('Modo administrador activado');
                } else {
                    showToast('Contrase√±a de administrador incorrecta', 'error');
                }
            } else {
                // Switch to client mode
                window.isAdmin = false;
                updateUIForRole();
                closeAdminPanel();
                showToast('Modo cliente activado');
            }
        };

        window.closeSidebar = function() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        };

        window.toggleSubmenu = function(submenu) {
            document.getElementById('submenu-' + submenu).classList.toggle('active');
        };

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            if (type === 'error') {
                toast.style.backgroundColor = '#f44336';
            }
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        window.showToast = showToast;

        // Carousel Functions
        window.carouselIndex = 0;
        function renderCarousel() {
            const slidesEl = document.getElementById('carouselSlides');
            if (!slidesEl) return;
            // Show first 8 products as carousel slides
            const carouselProducts = window.allProducts.slice(0, 8);
            slidesEl.innerHTML = carouselProducts.map(product => `
                <div class="carousel-slide">
                    <div class="carousel-product-card" onclick="openProductModal('${product.id}')">
                        <img src="${(product.imageUrls && product.imageUrls[0]) || product.imageUrl || 'https://via.placeholder.com/260x200'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/260x200'">
                        <div class="carousel-product-info">
                            <div class="carousel-product-name">${product.name}</div>
                            <div class="carousel-product-price">$${product.price.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Smooth carousel scroll with looping and autoplay when idle
        window.lastCarouselInteraction = Date.now();
        window.autoPlayInterval = 3000; // ms to wait before autoplay advances
        window.carouselTransitionMs = 420; // ms to wait for smooth scroll to finish

        window.scrollCarousel = function(direction) {
            const wrapperEl = document.querySelector('.carousel-wrapper');
            if (!wrapperEl) return;
            const slideEl = wrapperEl.querySelector('.carousel-slide');
            const gap = 12;
            const slideWidth = slideEl ? (slideEl.offsetWidth + gap) : (260 + gap);
            const maxScroll = Math.max(0, wrapperEl.scrollWidth - wrapperEl.offsetWidth);
            const current = wrapperEl.scrollLeft;
            let target = current + (direction * slideWidth);

            // Smoothly scroll; when reaching the end/beginning, animate to the edge then jump
            if (target >= maxScroll) {
                wrapperEl.scrollTo({ left: maxScroll, behavior: 'smooth' });
                setTimeout(() => { wrapperEl.scrollLeft = 0; }, window.carouselTransitionMs);
            } else if (target < 0) {
                wrapperEl.scrollTo({ left: 0, behavior: 'smooth' });
                setTimeout(() => { wrapperEl.scrollLeft = maxScroll; }, window.carouselTransitionMs);
            } else {
                wrapperEl.scrollTo({ left: target, behavior: 'smooth' });
            }

            // mark interaction to pause autoplay temporarily
            window.lastCarouselInteraction = Date.now();
        };

        // Trigger carousel scroll while the user is actively scrolling the page
        window._lastPageScrollTriggered = 0;
        window.addEventListener('scroll', () => {
            const now = Date.now();
            window.lastCarouselInteraction = now; // treat page scroll as interaction
            if (now - window._lastPageScrollTriggered > 800) {
                window.scrollCarousel(1);
                window._lastPageScrollTriggered = now;
            }
        });

        // Autoplay when idle (no interactions) ‚Äî checks periodically
        window._carouselAutoPlayTimer = setInterval(() => {
            const now = Date.now();
            if (now - (window.lastCarouselInteraction || 0) > window.autoPlayInterval) {
                window.scrollCarousel(1);
            }
        }, 1200);

        // Event Listeners
        document.getElementById('menuBtn').addEventListener('click', window.toggleSidebar);
        document.getElementById('cartBtn').addEventListener('click', window.toggleCart);
        document.getElementById('userBtn').addEventListener('click', window.openAuthModal);
        document.getElementById('overlay').addEventListener('click', window.closeSidebar);
        // Mode toggle button
        const modeBtnEl = document.getElementById('modeBtn');
        if (modeBtnEl) modeBtnEl.addEventListener('click', () => {
            if (window.isAdmin) window.switchMode('client'); else window.switchMode('admin');
        });
        // Search button opens search modal
        const searchBtn = document.getElementById('searchBtn');
        if (searchBtn) searchBtn.addEventListener('click', () => {
            openSearchModal();
        });

        window.openSearchModal = function() {
            document.getElementById('searchModal').classList.add('active');
            setTimeout(() => {
                const el = document.getElementById('headerSearchInput'); if (el) el.focus();
            }, 80);
        };

        window.closeSearchModal = function() {
            document.getElementById('searchModal').classList.remove('active');
        };

        window.performSearchFromModal = function() {
            const q = document.getElementById('headerSearchInput').value || '';
            document.getElementById('searchInput').value = q;
            applyFilters();
            // Show results count
            const count = (window.filteredProducts && window.filteredProducts.length) ? window.filteredProducts.length : 0;
            showToast('Resultados: ' + count, 'success');
            const s = document.getElementById('appStatus'); if (s) s.textContent = 'Resultados: ' + count + ' productos';
            closeSearchModal();
            // Scroll to products
            const el = document.getElementById('productsSection'); if (el) el.scrollIntoView({behavior:'smooth'});
        };

        // Trigger search when pressing Enter in the search modal input
        (function(){
            const headerInput = document.getElementById('headerSearchInput');
            if (headerInput) {
                headerInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        performSearchFromModal();
                    }
                });
            }
        })();

        

      // Cargar productos al iniciar
    loadProducts();
    updateCartUI();

    // Service Worker (registro relativo a la carpeta actual)
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => {
                console.log('SW registrado ‚úÖ', reg.scope);
            })
            .catch(err => {
                console.error('Error al registrar el SW ‚ùå', err);
            });
    }
</script>
<script>
    let deferredPrompt = null;

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('pwaInstallBtn').style.display = 'inline-flex';
    });

    document.getElementById('pwaInstallBtn').addEventListener('click', async () => {
        if (!deferredPrompt) return;

        deferredPrompt.prompt();
        const result = await deferredPrompt.userChoice;
        deferredPrompt = null;

        document.getElementById('pwaInstallBtn').style.display = 'none';
        document.getElementById('pwaInstalledLabel').style.display = 'inline';
    });
</script>
</body>
</html>
