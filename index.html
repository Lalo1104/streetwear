<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StreetWearX - Tienda Urbana</title>

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json" />

  <style>
    :root{
      --primary:#000000;
      --accent:#D4AF37;
      --bg:#f4f4f5;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --danger:#ef4444;
      --success:#16a34a;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* NAV */
    nav{
      position:sticky;
      top:0;
      z-index:20;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 18px;
      background:var(--primary);
      color:#fff;
      box-shadow:0 2px 8px rgba(0,0,0,0.25);
    }
    .nav-left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-circle{
      width:40px;
      height:40px;
      border-radius:50%;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--primary);
    }
    .brand-title{
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .brand-title span:first-child{
      font-weight:700;
      letter-spacing:0.05em;
    }
    .brand-title span:last-child{
      font-size:12px;
      color:#d1d5db;
    }
    .nav-right{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      cursor:pointer;
      padding:7px 12px;
      border-radius:999px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:#111827;
      color:#fff;
    }
    .btn-outline{
      background:transparent;
      border:1px solid #4b5563;
      color:#e5e7eb;
    }
    .btn-accent{
      background:var(--accent);
      color:#111;
      font-weight:600;
    }
    .btn-danger{
      background:var(--danger);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:16px;
    }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: minmax(0,2fr) minmax(0,1.4fr);
      gap:18px;
      margin-bottom:22px;
    }
    @media (max-width: 768px){
      .hero{
        grid-template-columns:1fr;
      }
    }
    .hero-card{
      background:linear-gradient(135deg,#000000,#111827);
      color:#f9fafb;
      border-radius:18px;
      padding:20px;
      position:relative;
      overflow:hidden;
    }
    .hero-card h1{
      font-size:24px;
      margin-bottom:8px;
    }
    .hero-card p{
      font-size:14px;
      color:#e5e7eb;
      max-width:320px;
    }
    .hero-tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:rgba(17,24,39,0.8);
      padding:5px 10px;
      border-radius:999px;
      font-size:11px;
      margin-bottom:10px;
      border:1px solid rgba(249,250,251,0.2);
    }
    .hero-badge{
      position:absolute;
      right:18px;
      bottom:18px;
      background:#f9fafb;
      color:#111827;
      padding:8px 12px;
      border-radius:12px;
      font-size:11px;
      text-align:right;
    }
    .hero-img{
      border-radius:18px;
      background:radial-gradient(circle at top,#111827, #000000);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#e5e7eb;
      font-size:14px;
      padding:16px;
    }

    /* Filtros */
    .filters{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
    }
    .filters-left{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .chip{
      padding:5px 10px;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#fff;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:#4b5563;
    }
    .chip.active{
      background:#111827;
      color:#f9fafb;
      border-color:#111827;
    }

    .status-text{
      font-size:12px;
      color:var(--muted);
    }

    /* Grid productos */
    .products-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(210px,1fr));
      gap:14px;
    }
    .product-card{
      background:var(--card);
      border-radius:16px;
      padding:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
      display:flex;
      flex-direction:column;
      min-height:100%;
    }
    .product-img{
      width:100%;
      height:190px;
      border-radius:12px;
      background:#111827;
      overflow:hidden;
      margin-bottom:8px;
    }
    .product-img img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .product-body{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
    }
    .product-title{
      font-weight:600;
    }
    .product-meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--muted);
    }
    .product-price{
      font-weight:700;
      font-size:15px;
    }
    .product-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:8px;
      gap:6px;
      flex-wrap:wrap;
    }
    .admin-actions{
      display:flex;
      gap:4px;
    }

    /* PANEL CARRITO */
    .cart-panel-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.35);
      display:none;
      align-items:stretch;
      justify-content:flex-end;
      z-index:40;
    }
    .cart-panel-backdrop.active{
      display:flex;
    }
    .cart-panel{
      width:100%;
      max-width:380px;
      background:#f9fafb;
      height:100%;
      display:flex;
      flex-direction:column;
      box-shadow:-2px 0 8px rgba(0,0,0,0.2);
    }
    .cart-header{
      padding:12px 14px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .cart-body{
      flex:1;
      overflow-y:auto;
      padding:10px 14px;
      font-size:13px;
    }
    .cart-footer{
      padding:10px 14px;
      border-top:1px solid #e5e7eb;
      background:#fff;
    }
    .cart-item{
      display:flex;
      gap:8px;
      margin-bottom:8px;
      border-bottom:1px solid #e5e7eb;
      padding-bottom:6px;
    }
    .cart-item-img{
      width:60px;
      height:60px;
      background:#111827;
      border-radius:8px;
      overflow:hidden;
      flex-shrink:0;
    }
    .cart-item-img img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .cart-item-body{
      flex:1;
    }
    .qty-controls{
      display:flex;
      align-items:center;
      gap:4px;
      margin-top:4px;
    }
    .qty-btn{
      width:22px;
      height:22px;
      border-radius:999px;
      border:none;
      background:#e5e7eb;
      cursor:pointer;
    }

    /* Toast */
    .toast{
      position:fixed;
      bottom:16px;
      left:50%;
      transform:translateX(-50%);
      background:#111827;
      color:#f9fafb;
      padding:9px 16px;
      border-radius:999px;
      font-size:13px;
      display:none;
      z-index:60;
    }
    .toast.success{ background:var(--success); }
    .toast.error{ background:var(--danger); }

  </style>
</head>
<body>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- PANEL CARRITO -->
  <div id="cartPanelBackdrop" class="cart-panel-backdrop">
    <div class="cart-panel">
      <div class="cart-header">
        <div>
          <strong>Carrito</strong>
          <div id="cartSubtitle">0 artículos</div>
        </div>
        <button class="btn btn-outline" id="closeCartBtn">Cerrar</button>
      </div>
      <div class="cart-body" id="cartItems"></div>
      <div class="cart-footer">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <span>Total</span>
          <strong id="cartTotal">$0.00</strong>
        </div>
        <button class="btn btn-accent" style="width:100%;">Finalizar compra</button>
      </div>
    </div>
  </div>

  <!-- Modal login admin -->
  <div id="adminLoginBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">Acceso administrador</span>
        <button class="modal-close" data-close-admin-login>&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Correo</label>
          <input type="email" id="adminEmail" placeholder="admin@streetwearx.com" />
        </div>
        <div class="form-group">
          <label>Contraseña</label>
          <input type="password" id="adminPassword" placeholder="********" />
        </div>
        <button class="btn btn-accent" id="adminLoginBtn" style="width:100%;margin-top:6px;">Entrar</button>
        <div style="font-size:11px;color:#9ca3af;margin-top:4px;">
          * Demo escolar (admin: admin@streetwearx.com / 123456)
        </div>
      </div>
    </div>
  </div>

  <!-- Modal producto -->
  <div id="productModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <span id="productModalTitle">Nuevo producto</span>
        <button class="modal-close" data-close-product>&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="productId" />
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" id="productName" />
        </div>
        <div class="form-group">
          <label>Precio</label>
          <input type="number" id="productPrice" />
        </div>
        <div class="form-group">
          <label>Categoría</label>
          <select id="productCategory">
            <option value="hombre">Hombre</option>
            <option value="mujer">Mujer</option>
            <option value="unisex">Unisex</option>
            <option value="accesorios">Accesorios</option>
          </select>
        </div>
        <div class="form-group">
          <label>Subcategoría</label>
          <input type="text" id="productSubcategory" />
        </div>
        <div class="form-group">
          <label>Stock</label>
          <input type="number" id="productStock" />
        </div>
        <div class="form-group">
          <label>Descripción</label>
          <textarea id="productDescription"></textarea>
        </div>
        <div class="form-group">
          <label>Imagen</label>
          <input type="file" id="productImage" accept="image/*" />
          <small style="font-size:11px;color:#9ca3af;">Sube a Cloudinary automáticamente</small>
        </div>
        <button class="btn btn-accent" id="saveProductBtn" style="width:100%;">Guardar</button>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <nav>
    <div class="nav-left">
      <div class="logo-circle">SWX</div>
      <div class="brand-title">
        <span>StreetWearX</span>
        <span>Ropa urbana</span>
      </div>
    </div>
    <div class="nav-right">
      <button class="btn btn-outline" id="adminPanelBtn">Admin</button>
      <button class="btn btn-accent" id="cartBtn">
        Carrito <span id="cartCount" style="background:#111827;color:white;border-radius:999px;padding:2px 7px;font-size:11px;">0</span>
      </button>
    </div>
  </nav>

  <!-- HERO -->
  <main>
    <section class="hero">
      <div class="hero-card">
        <div class="hero-tag">⚡ Nueva colección FW</div>
        <h1>Ropa urbana lista para la calle</h1>
        <p>Administra tu catálogo, controla inventario y vende desde cualquier dispositivo.</p>
        <button class="btn btn-accent" id="primaryCtaBtn">Ver productos</button>
        <div class="hero-badge">100% Responsive</div>
      </div>
      <div class="hero-img">Tu tienda en versión PWA</div>
    </section>

    <!-- FILTROS -->
    <section class="filters">
      <div class="filters-left">
        <span style="color:#6b7280;font-size:13px;">Categorías:</span>
        <button class="chip active" data-filter-category="todos">Todos</button>
        <button class="chip" data-filter-category="hombre">Hombre</button>
        <button class="chip" data-filter-category="mujer">Mujer</button>
        <button class="chip" data-filter-category="unisex">Unisex</button>
        <button class="chip" data-filter-category="accesorios">Accesorios</button>
      </div>
      <div class="status-text" id="appStatus">Cargando productos...</div>
    </section>

    <!-- GRID PRODUCTOS -->
    <section>
      <div class="products-grid" id="productsGrid"></div>
    </section>
  </main>

  <!-- SCRIPT PRINCIPAL -->
  <script type="module">
    /* ---------------- FIREBASE ---------------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_DOMAIN",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_BUCKET",
      messagingSenderId: "TU_SENDER",
      appId: "TU_APPID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* ---------------- CLOUDINARY ---------------- */
    const CLOUDINARY_CLOUD_NAME = "TU_CLOUD_NAME";
    const CLOUDINARY_UPLOAD_PRESET = "TU_PRESET";

    async function uploadImage(file) {
      const form = new FormData();
      form.append("file", file);
      form.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

      const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
        method: "POST",
        body: form
      });
      const data = await res.json();
      return data.secure_url;
    }

    /* ---------------- ESTADO ---------------- */
    let allProducts = [];
    let filteredProducts = [];
    let cart = JSON.parse(localStorage.getItem("swx_cart") || "[]");
    let isAdmin = false;

    /* ---------------- UI ---------------- */
    const productsGrid = document.getElementById("productsGrid");
    const cartCount = document.getElementById("cartCount");
    const appStatus = document.getElementById("appStatus");

    /* ---------------- CARGAR PRODUCTOS ---------------- */
    async function loadProducts() {
      const snap = await getDocs(collection(db, "products"));
      allProducts = [];
      snap.forEach(d => allProducts.push({ id: d.id, ...d.data() }));
      applyFilters();
    }

    function applyFilters() {
      filteredProducts = allProducts;
      renderProducts(filteredProducts);
    }

    function renderProducts(list) {
      if (list.length === 0) {
        productsGrid.innerHTML = "<p>No hay productos</p>";
        appStatus.textContent = "Productos cargados: 0";
        return;
      }

      productsGrid.innerHTML = list.map(p => `
        <div class="product-card">
          <div class="product-img">
            <img src="${p.imageURL || ''}" alt="">
          </div>
          <div class="product-body">
            <div class="product-title">${p.name}</div>
            <div class="product-price">$${p.price}</div>
          </div>
          <div class="product-footer">
            <button class="btn" onclick="addToCart('${p.id}')">Agregar</button>
            ${isAdmin ? `
            <button class="btn btn-outline" onclick="editProduct('${p.id}')">Editar</button>
            <button class="btn btn-danger" onclick="deleteProduct('${p.id}')">Borrar</button>` : ""}
          </div>
        </div>
      `).join("");

      appStatus.textContent = "Productos cargados: " + list.length;
    }

    /* ---------------- CARRITO ---------------- */
    window.addToCart = function(id) {
      alert("Producto agregado: " + id);
    };

    /* ---------------- INICIO ---------------- */
    loadProducts();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>

</body>
</html>
