<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StreetWearX — Tienda Urbana</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon.png" />

  <style>
    :root{
      --black:#000000;
      --gold:#D4AF37;
      --bg:#050505;
      --card:#111111;
      --text:#f9fafb;
      --muted:#9ca3af;
      --danger:#ef4444;
      --success:#16a34a;
      --radius:14px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* NAVBAR */
    nav{
      position:sticky;
      top:0;
      z-index:30;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 18px;
      background:rgba(0,0,0,0.9);
      backdrop-filter:blur(10px);
      border-bottom:1px solid #222;
    }
    .nav-left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-circle{
      width:40px;
      height:40px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #ffffff, #999999, #000000);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      color:#000;
      font-size:14px;
    }
    .brand-title{
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .brand-title span:first-child{
      font-weight:800;
      letter-spacing:0.1em;
      text-transform:uppercase;
    }
    .brand-title span:last-child{
      font-size:12px;
      color:var(--muted);
    }
    .nav-right{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      cursor:pointer;
      padding:7px 12px;
      border-radius:999px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:#111827;
      color:#f9fafb;
      transition:.15s;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
    .btn-outline{
      background:transparent;
      border:1px solid #4b5563;
      color:#e5e7eb;
    }
    .btn-gold{
      background:var(--gold);
      color:#111;
      font-weight:600;
    }
    .btn-danger{background:var(--danger);}
    .badge{
      padding:2px 8px;
      border-radius:999px;
      background:#16a34a;
      color:#ecfdf5;
      font-size:11px;
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:16px;
    }

    /* HERO GRAFFITI (banner 3) */
    .hero{
      border-radius:22px;
      overflow:hidden;
      position:relative;
      margin-bottom:22px;
      background:#000;
    }
    .hero-bg{
      position:absolute;
      inset:0;
      background-image:url("https://images.pexels.com/photos/3831846/pexels-photo-3831846.jpeg");
      background-size:cover;
      background-position:center;
      filter:brightness(0.45);
    }
    .hero-overlay{
      position:relative;
      padding:22px 18px 26px;
      display:grid;
      grid-template-columns:minmax(0,2.1fr) minmax(0,1.6fr);
      gap:12px;
    }
    @media(max-width:768px){
      .hero-overlay{
        grid-template-columns:1fr;
      }
    }
    .hero-main{
      z-index:1;
    }
    .hero-kicker{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(0,0,0,0.7);
      border:1px solid rgba(212,175,55,0.6);
      font-size:11px;
      color:var(--gold);
      margin-bottom:8px;
    }
    .hero-title{
      font-size:26px;
      font-weight:800;
      letter-spacing:0.06em;
      text-transform:uppercase;
      margin-bottom:6px;
    }
    .hero-subtitle{
      font-size:14px;
      color:#e5e7eb;
      max-width:380px;
      margin-bottom:12px;
    }
    .hero-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      font-size:12px;
    }
    .hero-tagline{
      font-size:11px;
      color:#d1d5db;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .hero-tagline-dot{
      width:7px;height:7px;border-radius:999px;background:#22c55e;
    }
    .hero-side{
      z-index:1;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:10px;
    }
    .hero-stat{
      align-self:flex-end;
      padding:9px 12px;
      border-radius:14px;
      background:rgba(0,0,0,0.65);
      border:1px solid rgba(148,163,184,0.4);
      font-size:11px;
      color:#e5e7eb;
      max-width:210px;
    }
    .hero-stat strong{
      color:var(--gold);
      font-size:13px;
    }

    /* FEATURED CAROUSEL (C - portada) */
    .featured-section{
      margin-bottom:20px;
    }
    .featured-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .featured-header h2{
      font-size:16px;
    }
    .featured-slider{
      position:relative;
      border-radius:20px;
      overflow:hidden;
      border:1px solid #1f2937;
      background:#020617;
      min-height:190px;
    }
    .featured-slide{
      position:relative;
      padding:16px;
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1.6fr);
      gap:12px;
    }
    @media(max-width:768px){
      .featured-slide{
        grid-template-columns:1fr;
      }
    }
    .featured-bg{
      position:absolute;
      inset:0;
      background-position:center;
      background-size:cover;
      filter:brightness(0.35);
      opacity:0.95;
    }
    .featured-content{
      position:relative;
      z-index:1;
    }
    .featured-label{
      display:inline-flex;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(0,0,0,0.75);
      border:1px solid rgba(212,175,55,0.7);
      font-size:11px;
      margin-bottom:6px;
      color:var(--gold);
    }
    .featured-name{
      font-size:18px;
      font-weight:700;
      margin-bottom:4px;
    }
    .featured-meta{
      font-size:12px;
      color:#e5e7eb;
      margin-bottom:8px;
    }
    .featured-price{
      font-size:16px;
      color:var(--gold);
      font-weight:700;
      margin-bottom:10px;
    }
    .featured-actions{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .featured-thumb{
      position:relative;
      z-index:1;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,0.6);
      background:#020617;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .featured-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .featured-nav{
      position:absolute;
      inset-block:0;
      inset-inline:0;
      pointer-events:none;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .featured-nav button{
      pointer-events:auto;
      border:none;
      background:rgba(0,0,0,0.6);
      color:#e5e7eb;
      border-radius:999px;
      width:28px;height:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
      margin-inline:8px;
    }

    /* FILTROS + STATUS */
    .filters{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
      margin-top:4px;
    }
    .filters-left{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .chip{
      padding:5px 10px;
      border-radius:999px;
      border:1px solid #374151;
      background:#020617;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:#e5e7eb;
    }
    .chip.active{
      background:var(--gold);
      color:#111827;
      border-color:var(--gold);
    }
    .status-text{
      font-size:12px;
      color:var(--muted);
    }

    /* GRID PRODUCTOS */
    .products-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(210px,1fr));
      gap:14px;
    }
    .product-card{
      background:var(--card);
      border-radius:18px;
      padding:10px;
      border:1px solid #111827;
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
      display:flex;
      flex-direction:column;
      min-height:100%;
    }
    .product-img{
      width:100%;
      height:190px;
      border-radius:14px;
      background:#020617;
      overflow:hidden;
      margin-bottom:8px;
    }
    .product-img img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .product-body{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
    }
    .product-title{
      font-weight:600;
      letter-spacing:0.03em;
      text-transform:uppercase;
    }
    .product-meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--muted);
    }
    .product-price{
      font-weight:700;
      font-size:15px;
      color:var(--gold);
    }
    .product-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:8px;
      gap:6px;
      flex-wrap:wrap;
    }
    .admin-actions{
      display:flex;
      gap:4px;
    }

    /* CARRITO (backdrop + panel) */
    .cart-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      justify-content:flex-end;
      z-index:40;
    }
    .cart-backdrop.active{
      display:flex;
    }
    .cart-panel{
      width:100%;
      max-width:380px;
      background:#020617;
      border-left:1px solid #111827;
      display:flex;
      flex-direction:column;
      height:100%;
    }
    .cart-header{
      padding:12px 14px;
      border-bottom:1px solid #111827;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .cart-header h2{
      font-size:15px;
    }
    .cart-body{
      flex:1;
      overflow-y:auto;
      padding:10px 14px;
      font-size:13px;
    }
    .cart-footer{
      padding:10px 14px;
      border-top:1px solid #111827;
      background:#020617;
    }
    .cart-item{
      display:flex;
      gap:8px;
      margin-bottom:8px;
      border-bottom:1px solid #111827;
      padding-bottom:6px;
    }
    .cart-item-img{
      width:60px;
      height:60px;
      border-radius:10px;
      overflow:hidden;
      background:#0b1120;
      flex-shrink:0;
    }
    .cart-item-img img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .cart-item-body{
      flex:1;
    }
    .cart-item-body-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
    }
    .qty-controls{
      display:flex;
      align-items:center;
      gap:4px;
      margin-top:4px;
    }
    .qty-btn{
      width:22px;
      height:22px;
      border-radius:999px;
      border:none;
      background:#1f2937;
      color:#e5e7eb;
      cursor:pointer;
      font-size:14px;
    }

    /* MODAL GENÉRICO (login + producto) */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .modal-backdrop.active{
      display:flex;
    }
    .modal{
      width:100%;
      max-width:420px;
      background:#020617;
      border-radius:18px;
      padding:16px;
      border:1px solid #1f2937;
      box-shadow:0 20px 45px rgba(0,0,0,0.8);
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .modal-title{
      font-weight:600;
      font-size:15px;
    }
    .modal-close{
      border:none;
      background:transparent;
      color:#9ca3af;
      font-size:18px;
      cursor:pointer;
    }
    .modal-body{
      font-size:13px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .form-group{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .form-group label{
      font-size:12px;
      color:var(--muted);
    }
    .form-group input,
    .form-group textarea,
    .form-group select{
      padding:7px 9px;
      border-radius:9px;
      border:1px solid #1f2937;
      font-size:13px;
      background:#020617;
      color:#e5e7eb;
      outline:none;
    }
    .form-group textarea{
      resize:vertical;
      min-height:60px;
    }
    .form-note{
      font-size:11px;
      color:#6b7280;
    }

    /* TOAST */
    .toast{
      position:fixed;
      bottom:16px;
      left:50%;
      transform:translateX(-50%);
      background:#111827;
      color:#f9fafb;
      padding:9px 16px;
      border-radius:999px;
      font-size:13px;
      display:none;
      z-index:60;
    }
    .toast.success{background:var(--success);}
    .toast.error{background:var(--danger);}

    /* BOTÓN INSTALAR PWA */
    #installBtn{
      position:fixed;
      bottom:20px;
      right:20px;
      padding:10px 16px;
      background:var(--gold);
      color:#111827;
      font-weight:700;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:13px;
      display:none;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      z-index:55;
    }
  </style>
</head>
<body>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <!-- NAV -->
  <nav>
    <div class="nav-left">
      <div class="logo-circle">SWX</div>
      <div class="brand-title">
        <span>StreetWearX</span>
        <span>Ropa urbana & sneakers</span>
      </div>
    </div>
    <div class="nav-right">
      <button class="btn-outline" id="adminBtn">Admin</button>
      <button class="btn-gold" id="cartBtn">
        Carrito <span id="cartCount" style="background:#111827;color:#f9fafb;border-radius:999px;padding:2px 7px;font-size:11px;">0</span>
      </button>
    </div>
  </nav>

  <main>
    <!-- HERO GRAFFITI -->
    <section class="hero">
      <div class="hero-bg"></div>
      <div class="hero-overlay">
        <div class="hero-main">
          <div class="hero-kicker">
            ⚡ Nueva colección FW • Street
          </div>
          <h1 class="hero-title">Ropa urbana lista para la calle.</h1>
          <p class="hero-subtitle">
            Administra tu catálogo, controla inventario y permite a tus clientes comprar desde cualquier dispositivo con tu PWA StreetWearX.
          </p>
          <div class="hero-actions">
            <button class="btn-gold" id="primaryCtaBtn">Ver colección</button>
            <button class="btn" id="openCartFromHero">Ver carrito</button>
            <span class="hero-tagline">
              <span class="hero-tagline-dot"></span>
              Instalación como app disponible
            </span>
          </div>
        </div>
        <div class="hero-side">
          <div class="hero-stat">
            <strong>420+</strong><br>
            Productos gestionados en Firestore para proyectos escolares y tiendas reales.
          </div>
          <div class="hero-stat">
            <strong>Cloudinary + Firebase</strong><br>
            Imágenes optimizadas, catálogo en tiempo real, lista para GitHub Pages.
          </div>
        </div>
      </div>
    </section>

    <!-- CARRUSEL DESTACADOS (tipo portada C) -->
    <section class="featured-section" id="featuredSection" style="display:none;">
      <div class="featured-header">
        <h2>Destacados de la semana</h2>
        <span style="font-size:12px;color:var(--muted);">Marcados como “destacado” en el panel admin</span>
      </div>
      <div class="featured-slider">
        <div class="featured-slide">
          <div class="featured-bg" id="featuredBg"></div>
          <div class="featured-content">
            <div class="featured-label">Destacado</div>
            <div class="featured-name" id="featuredName"></div>
            <div class="featured-meta" id="featuredMeta"></div>
            <div class="featured-price" id="featuredPrice"></div>
            <div class="featured-actions">
              <button class="btn-gold" id="featuredAddToCartBtn">Agregar al carrito</button>
              <button class="btn-outline" id="featuredScrollToGridBtn">Ver más producto</button>
            </div>
          </div>
          <div class="featured-thumb">
            <img id="featuredImage" src="" alt="Producto destacado">
          </div>
        </div>
        <div class="featured-nav">
          <button id="prevFeaturedBtn">‹</button>
          <button id="nextFeaturedBtn">›</button>
        </div>
      </div>
    </section>

    <!-- FILTROS -->
    <section class="filters">
      <div class="filters-left">
        <span style="font-size:13px;color:var(--muted);">Categorías:</span>
        <button class="chip active" data-filter-category="todos">Todos</button>
        <button class="chip" data-filter-category="hombre">Hombre</button>
        <button class="chip" data-filter-category="mujer">Mujer</button>
        <button class="chip" data-filter-category="unisex">Unisex</button>
        <button class="chip" data-filter-category="accesorios">Accesorios</button>
      </div>
      <div class="status-text" id="appStatus">Cargando productos...</div>
    </section>

    <!-- GRID PRODUCTOS -->
    <section>
      <div class="products-grid" id="productsGrid"></div>
    </section>
  </main>

  <!-- CARRITO (backdrop + panel) -->
  <div id="cartBackdrop" class="cart-backdrop">
    <div class="cart-panel">
      <div class="cart-header">
        <div>
          <h2>Carrito</h2>
          <div id="cartSubtitle" style="font-size:11px;color:var(--muted);">0 artículos</div>
        </div>
        <button class="btn-outline" id="closeCartBtn">Cerrar</button>
      </div>
      <div class="cart-body" id="cartItems"></div>
      <div class="cart-footer">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;font-size:14px;">
          <span>Total</span>
          <strong id="cartTotal">$0.00</strong>
        </div>
        <button class="btn-gold" style="width:100%;">Finalizar compra</button>
      </div>
    </div>
  </div>

  <!-- MODAL LOGIN ADMIN -->
  <div id="adminLoginBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">Acceso administrador</span>
        <button class="modal-close" data-close-admin-login>&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Contraseña</label>
          <input type="password" id="adminPassword" placeholder="Streetwear" />
        </div>
        <div class="form-note">Contraseña demo: <strong>Streetwear</strong></div>
        <button class="btn-gold" id="adminLoginBtn" style="width:100%;margin-top:8px;">Entrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL PRODUCTO (crear/editar) -->
  <div id="productModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title" id="productModalTitle">Nuevo producto</span>
        <button class="modal-close" data-close-product>&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="productId" />
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" id="productName" />
        </div>
        <div class="form-group">
          <label>Precio (MXN)</label>
          <input type="number" id="productPrice" step="0.01" min="0" />
        </div>
        <div class="form-group">
          <label>Categoría</label>
          <select id="productCategory">
            <option value="hombre">Hombre</option>
            <option value="mujer">Mujer</option>
            <option value="unisex">Unisex</option>
            <option value="accesorios">Accesorios</option>
          </select>
        </div>
        <div class="form-group">
          <label>Stock</label>
          <input type="number" id="productStock" min="0" />
        </div>
        <div class="form-group">
          <label>Descripción</label>
          <textarea id="productDescription"></textarea>
        </div>
        <div class="form-group">
          <label>Imagen</label>
          <input type="file" id="productImage" accept="image/*" />
          <div class="form-note">Se sube a Cloudinary (preset unsigned).</div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="productFeatured" />
            Destacado (aparece en el carrusel)
          </label>
        </div>
        <button class="btn-gold" id="saveProductBtn" style="width:100%;margin-top:6px;">Guardar producto</button>
      </div>
    </div>
  </div>

  <!-- BOTÓN INSTALAR PWA -->
  <button id="installBtn">Instalar StreetWearX</button>

  <!-- SCRIPT PRINCIPAL -->
  <script type="module">
    // -------------------------------
    //  FIREBASE
    // -------------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      updateDoc,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-Ag7WIUBcGgJPBg6taUqtGVHgWAwekhY",
      authDomain: "proyect1-37d04.firebaseapp.com",
      projectId: "proyect1-37d04",
      storageBucket: "proyect1-37d04.firebasestorage.app",
      messagingSenderId: "989990045683",
      appId: "1:989990045683:web:778984a898aa4046097486",
      measurementId: "G-WBQ6DYGRG8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // -------------------------------
    //  CLOUDINARY
    // -------------------------------
    const CLOUD_NAME = "dv5pdjhso";
    const PRESET = "streetwearx_unsigned";

    async function uploadImageToCloudinary(file) {
      if (!file) return null;
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", PRESET);

      const res = await fetch(\`https://api.cloudinary.com/v1_1/\${CLOUD_NAME}/image/upload\`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      if (!res.ok) {
        console.error("Cloudinary error:", data);
        throw new Error(data.error?.message || "Error al subir imagen");
      }
      return data.secure_url;
    }

    // -------------------------------
    //  ESTADO GLOBAL
    // -------------------------------
    let allProducts = [];
    let filteredProducts = [];
    let featuredProducts = [];
    let currentCategoryFilter = "todos";
    let isAdmin = false;
    let cart = [];
    let currentFeaturedIndex = 0;

    try {
      cart = JSON.parse(localStorage.getItem("swx_cart") || "[]");
    } catch { cart = []; }

    // -------------------------------
    //  ELEMENTOS UI
    // -------------------------------
    const toastEl = document.getElementById("toast");
    const productsGrid = document.getElementById("productsGrid");
    const appStatus = document.getElementById("appStatus");

    const cartBackdrop = document.getElementById("cartBackdrop");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const cartSubtitleEl = document.getElementById("cartSubtitle");
    const cartCountEl = document.getElementById("cartCount");
    const closeCartBtn = document.getElementById("closeCartBtn");

    const adminBtn = document.getElementById("adminBtn");
    const adminLoginBackdrop = document.getElementById("adminLoginBackdrop");
    const adminPasswordInput = document.getElementById("adminPassword");
    const adminLoginBtn = document.getElementById("adminLoginBtn");

    const productModalBackdrop = document.getElementById("productModalBackdrop");
    const productModalTitle = document.getElementById("productModalTitle");
    const productIdInput = document.getElementById("productId");
    const productNameInput = document.getElementById("productName");
    const productPriceInput = document.getElementById("productPrice");
    const productCategorySelect = document.getElementById("productCategory");
    const productStockInput = document.getElementById("productStock");
    const productDescriptionInput = document.getElementById("productDescription");
    const productImageInput = document.getElementById("productImage");
    const productFeaturedInput = document.getElementById("productFeatured");
    const saveProductBtn = document.getElementById("saveProductBtn");

    const featuredSection = document.getElementById("featuredSection");
    const featuredBg = document.getElementById("featuredBg");
    const featuredName = document.getElementById("featuredName");
    const featuredMeta = document.getElementById("featuredMeta");
    const featuredPrice = document.getElementById("featuredPrice");
    const featuredImage = document.getElementById("featuredImage");
    const featuredAddToCartBtn = document.getElementById("featuredAddToCartBtn");
    const featuredScrollToGridBtn = document.getElementById("featuredScrollToGridBtn");
    const prevFeaturedBtn = document.getElementById("prevFeaturedBtn");
    const nextFeaturedBtn = document.getElementById("nextFeaturedBtn");

    const primaryCtaBtn = document.getElementById("primaryCtaBtn");
    const openCartFromHeroBtn = document.getElementById("openCartFromHero");
    const cartBtn = document.getElementById("cartBtn");

    // -------------------------------
    //  TOAST
    // -------------------------------
    function showToast(msg, type = "info") {
      if (!toastEl) return;
      toastEl.textContent = msg;
      toastEl.className = "toast";
      if (type === "success") toastEl.classList.add("success");
      if (type === "error") toastEl.classList.add("error");
      toastEl.style.display = "block";
      setTimeout(() => { toastEl.style.display = "none"; }, 2500);
    }

    // -------------------------------
    //  CARRITO
    // -------------------------------
    function saveCart() {
      localStorage.setItem("swx_cart", JSON.stringify(cart));
    }

    function updateCartUI() {
      const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
      const total = cart.reduce((sum, item) => sum + item.qty * (Number(item.price) || 0), 0);

      cartCountEl.textContent = totalItems;
      cartSubtitleEl.textContent = totalItems === 1 ? "1 artículo" : \`\${totalItems} artículos\`;
      cartTotalEl.textContent = \`$\${total.toFixed(2)}\`;

      if (cart.length === 0) {
        cartItemsEl.innerHTML = "<p style='color:#9ca3af;'>Tu carrito está vacío.</p>";
        return;
      }

      cartItemsEl.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="cart-item-img">
            ${item.imageURL ? `<img src="${item.imageURL}" alt="${item.name}">` : ""}
          </div>
          <div class="cart-item-body">
            <div class="cart-item-body-header">
              <span style="font-weight:600;">${item.name}</span>
              <span style="font-size:12px;color:#e5e7eb;">$${Number(item.price || 0).toFixed(2)}</span>
            </div>
            <div class="qty-controls">
              <button class="qty-btn" data-qty-action="dec" data-id="${item.id}">-</button>
              <span style="min-width:20px;text-align:center;">${item.qty}</span>
              <button class="qty-btn" data-qty-action="inc" data-id="${item.id}">+</button>
              <button class="btn-danger" style="margin-left:auto;padding:2px 8px;font-size:11px;border-radius:999px;border:none;cursor:pointer;" data-remove-item="${item.id}">Quitar</button>
            </div>
          </div>
        </div>
      `).join("");
    }

    window.addToCart = function(productId) {
      const p = allProducts.find(p => p.id === productId);
      if (!p) return;

      const existing = cart.find(i => i.id === productId);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({
          id: p.id,
          name: p.name || "Producto",
          price: Number(p.price) || 0,
          imageURL: p.imageURL || "",
          qty: 1
        });
      }
      saveCart();
      updateCartUI();
      showToast("Producto agregado al carrito", "success");
    };

    cartItemsEl.addEventListener("click", (e) => {
      const incBtn = e.target.closest("[data-qty-action='inc']");
      const decBtn = e.target.closest("[data-qty-action='dec']");
      const removeBtn = e.target.closest("[data-remove-item]");

      if (incBtn) {
        const id = incBtn.getAttribute("data-id");
        const item = cart.find(i => i.id === id);
        if (item) item.qty += 1;
      }
      if (decBtn) {
        const id = decBtn.getAttribute("data-id");
        const item = cart.find(i => i.id === id);
        if (item && item.qty > 1) item.qty -= 1;
      }
      if (removeBtn) {
        const id = removeBtn.getAttribute("data-remove-item");
        cart = cart.filter(i => i.id !== id);
      }
      saveCart();
      updateCartUI();
    });

    // -------------------------------
    //  ADMIN LOGIN (contraseña: Streetwear)
    // -------------------------------
    const ADMIN_PASSWORD = "Streetwear";

    adminBtn.addEventListener("click", () => {
      if (isAdmin) {
        openProductModal(); // nuevo producto
      } else {
        adminLoginBackdrop.classList.add("active");
        adminPasswordInput.value = "";
      }
    });

    document.querySelector("[data-close-admin-login]").addEventListener("click", () => {
      adminLoginBackdrop.classList.remove("active");
    });

    adminLoginBackdrop.addEventListener("click", (e) => {
      if (e.target === adminLoginBackdrop) {
        adminLoginBackdrop.classList.remove("active");
      }
    });

    adminLoginBtn.addEventListener("click", () => {
      const pass = (adminPasswordInput.value || "").trim();
      if (pass === ADMIN_PASSWORD) {
        isAdmin = true;
        adminLoginBackdrop.classList.remove("active");
        adminBtn.textContent = "Nuevo producto";
        showToast("Modo administrador activado", "success");
        renderProducts(filteredProducts);
      } else {
        showToast("Contraseña incorrecta", "error");
      }
    });

    // -------------------------------
    //  MODAL PRODUCTO
    // -------------------------------
    function openProductModal(product = null) {
      if (!isAdmin) {
        showToast("Acceso solo administrador", "error");
        return;
      }

      if (product) {
        productModalTitle.textContent = "Editar producto";
        productIdInput.value = product.id;
        productNameInput.value = product.name || "";
        productPriceInput.value = product.price || "";
        productCategorySelect.value = product.category || "hombre";
        productStockInput.value = product.stock ?? "";
        productDescriptionInput.value = product.description || "";
        productFeaturedInput.checked = !!product.featured;
        productImageInput.value = "";
      } else {
        productModalTitle.textContent = "Nuevo producto";
        productIdInput.value = "";
        productNameInput.value = "";
        productPriceInput.value = "";
        productCategorySelect.value = "hombre";
        productStockInput.value = "";
        productDescriptionInput.value = "";
        productFeaturedInput.checked = false;
        productImageInput.value = "";
      }

      productModalBackdrop.classList.add("active");
    }

    function closeProductModal() {
      productModalBackdrop.classList.remove("active");
    }

    document.querySelector("[data-close-product]").addEventListener("click", closeProductModal);
    productModalBackdrop.addEventListener("click", (e) => {
      if (e.target === productModalBackdrop) closeProductModal();
    });

    saveProductBtn.addEventListener("click", async () => {
      if (!isAdmin) {
        showToast("No tienes permisos para guardar productos", "error");
        return;
      }

      const id = productIdInput.value || null;
      const name = productNameInput.value.trim();
      const price = Number(productPriceInput.value || 0);
      const category = productCategorySelect.value;
      const stock = Number(productStockInput.value || 0);
      const description = productDescriptionInput.value.trim();
      const featured = productFeaturedInput.checked;
      const imageFile = productImageInput.files[0];

      if (!name || !price) {
        showToast("Nombre y precio son obligatorios", "error");
        return;
      }

      try {
        saveProductBtn.disabled = true;
        saveProductBtn.textContent = "Guardando...";

        let imageURL = null;
        if (imageFile) {
          imageURL = await uploadImageToCloudinary(imageFile);
        }

        const payload = {
          name,
          price,
          category,
          stock,
          description,
          featured
        };
        if (imageURL) payload.imageURL = imageURL;

        if (id) {
          const ref = doc(db, "products", id);
          await updateDoc(ref, payload);
          showToast("Producto actualizado", "success");
        } else {
          await addDoc(collection(db, "products"), {
            ...payload,
            createdAt: new Date()
          });
          showToast("Producto creado", "success");
        }

        closeProductModal();
        await loadProducts();
      } catch (err) {
        console.error("Error guardando producto:", err);
        showToast("Error al guardar producto", "error");
      } finally {
        saveProductBtn.disabled = false;
        saveProductBtn.textContent = "Guardar producto";
      }
    });

    window.editProduct = function(id) {
      const p = allProducts.find(p => p.id === id);
      if (!p) return;
      openProductModal(p);
    };

    window.deleteProduct = async function(id) {
      if (!isAdmin) {
        showToast("Solo administrador puede borrar", "error");
        return;
      }
      if (!confirm("¿Seguro que deseas eliminar este producto?")) return;

      try {
        await deleteDoc(doc(db, "products", id));
        showToast("Producto eliminado", "success");
        await loadProducts();
      } catch (err) {
        console.error(err);
        showToast("Error al eliminar", "error");
      }
    };

    // -------------------------------
    //  FILTROS
    // -------------------------------
    const filterChips = document.querySelectorAll("[data-filter-category]");

    filterChips.forEach(chip => {
      chip.addEventListener("click", () => {
        const value = chip.getAttribute("data-filter-category");
        currentCategoryFilter = value;

        filterChips.forEach(c => c.classList.remove("active"));
        chip.classList.add("active");

        applyFilters();
      });
    });

    function applyFilters() {
      if (currentCategoryFilter === "todos") {
        filteredProducts = allProducts.slice();
      } else {
        filteredProducts = allProducts.filter(p => (p.category || "").toLowerCase() === currentCategoryFilter);
      }
      renderProducts(filteredProducts);
    }

    // -------------------------------
    //  RENDER PRODUCTOS
    // -------------------------------
    function renderProducts(list) {
      if (!list || list.length === 0) {
        productsGrid.innerHTML = "<p style='padding:10px;font-size:13px;color:#9ca3af;'>No hay productos disponibles.</p>";
        appStatus.textContent = "Productos cargados: 0";
        return;
      }

      productsGrid.innerHTML = list.map(p => {
        const adminButtons = isAdmin ? `
          <div class="admin-actions">
            <button class="btn-outline" onclick="editProduct('${p.id}')">Editar</button>
            <button class="btn-danger" onclick="deleteProduct('${p.id}')">Borrar</button>
          </div>` : "";

        return `
          <article class="product-card">
            <div class="product-img">
              ${p.imageURL ? `<img src="${p.imageURL}" alt="${p.name}">` : ""}
            </div>
            <div class="product-body">
              <div class="product-title">${p.name || "Producto sin nombre"}</div>
              <div class="product-meta">
                <span>${p.category || "Sin categoría"}</span>
                <span class="product-price">$${Number(p.price || 0).toFixed(2)}</span>
              </div>
              ${typeof p.stock === "number" ? `<div style="font-size:11px;color:#9ca3af;">Stock: ${p.stock}</div>` : ""}
            </div>
            <div class="product-footer">
              <button class="btn" style="flex:1;" onclick="addToCart('${p.id}')">Agregar al carrito</button>
              ${adminButtons}
            </div>
          </article>
        `;
      }).join("");

      appStatus.textContent = \`Productos cargados: \${list.length}\`;
    }

    // -------------------------------
    //  CARRUSEL DESTACADOS
    // -------------------------------
    function updateFeaturedProducts() {
      featuredProducts = allProducts.filter(p => p.featured);
      if (featuredProducts.length === 0 && allProducts.length > 0) {
        featuredProducts = allProducts.slice(0, 3);
      }
      if (featuredProducts.length === 0) {
        featuredSection.style.display = "none";
      } else {
        featuredSection.style.display = "";
        currentFeaturedIndex = 0;
        renderFeaturedSlide();
      }
    }

    function renderFeaturedSlide() {
      if (!featuredProducts || featuredProducts.length === 0) return;
      const p = featuredProducts[currentFeaturedIndex];

      featuredBg.style.backgroundImage = p.imageURL ? \`url('${p.imageURL}')\` : "none";
      featuredName.textContent = p.name || "Producto destacado";
      featuredMeta.textContent = \`\${p.category || "Sin categoría"} • Stock: \${p.stock ?? "N/D"}\`;
      featuredPrice.textContent = \`$\${Number(p.price || 0).toFixed(2)}\`;
      featuredImage.src = p.imageURL || "";
      featuredImage.alt = p.name || "Producto destacado";

      featuredAddToCartBtn.onclick = () => addToCart(p.id);
    }

    prevFeaturedBtn.addEventListener("click", () => {
      if (!featuredProducts.length) return;
      currentFeaturedIndex = (currentFeaturedIndex - 1 + featuredProducts.length) % featuredProducts.length;
      renderFeaturedSlide();
    });
    nextFeaturedBtn.addEventListener("click", () => {
      if (!featuredProducts.length) return;
      currentFeaturedIndex = (currentFeaturedIndex + 1) % featuredProducts.length;
      renderFeaturedSlide();
    });

    featuredScrollToGridBtn.addEventListener("click", () => {
      window.scrollTo({ top: productsGrid.offsetTop - 60, behavior: "smooth" });
    });

    // -------------------------------
    //  CARGAR PRODUCTOS DESDE FIRESTORE
    // -------------------------------
    async function loadProducts() {
      try {
        appStatus.textContent = "Cargando productos...";
        const snap = await getDocs(collection(db, "products"));
        allProducts = [];
        snap.forEach(docSnap => {
          allProducts.push({ id: docSnap.id, ...docSnap.data() });
        });
        applyFilters();
        updateFeaturedProducts();
      } catch (err) {
        console.error("Error cargando productos:", err);
        appStatus.textContent = "Error al cargar productos";
        showToast("Error al cargar productos", "error");
      }
    }

    // -------------------------------
    //  CARRITO - ABRIR / CERRAR
    // -------------------------------
    function openCart() {
      cartBackdrop.classList.add("active");
    }
    function closeCart() {
      cartBackdrop.classList.remove("active");
    }

    cartBtn.addEventListener("click", openCart);
    openCartFromHeroBtn.addEventListener("click", openCart);
    closeCartBtn.addEventListener("click", closeCart);
    cartBackdrop.addEventListener("click", (e) => {
      if (e.target === cartBackdrop) {
        closeCart();
      }
    });

    // -------------------------------
    //  CTA HERO
    // -------------------------------
    primaryCtaBtn.addEventListener("click", () => {
      window.scrollTo({ top: productsGrid.offsetTop - 60, behavior: "smooth" });
    });

    // -------------------------------
    //  PWA INSTALL
    // -------------------------------
    let deferredPrompt;
    const installBtn = document.getElementById("installBtn");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = "block";
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      installBtn.style.display = "none";
      deferredPrompt.prompt();
    });

    // -------------------------------
    //  INICIO
    // -------------------------------
    function init() {
      updateCartUI();
      loadProducts();

      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./sw.js")
          .catch(err => console.log("Error al registrar SW:", err));
      }
    }

    init();
  </script>

</body>
</html>
